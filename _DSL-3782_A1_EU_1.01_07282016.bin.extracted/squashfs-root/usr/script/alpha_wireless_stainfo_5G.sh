#!/bin/sh

DATA_FILE="/var/tmp/stainfott5g.cfg"
/userfs/bin/iwpriv rai0 ar9_show stainfott > /var/tmp/stainfott5g.cfg

#Clear old info
#/userfs/bin/tcapi unset Info_WLan

#	Check data file
if [ -z "$DATA_FILE" ]; then
	echo "No data file to process"
	exit 1
fi
if [ ! -f "$DATA_FILE" ]; then
	echo "$DATA_FILE no exist"
	exit 1
fi

#	Get line number of data file
TOTAL_LINE=`sed -n "$=" $DATA_FILE`
TOTAL_LINE=`expr $TOTAL_LINE - 1`

/userfs/bin/tcapi set Info_WLan11ac StaNum `expr $TOTAL_LINE - 2`

LINE=`sed -n "2p" $DATA_FILE`
# Get HTBW
    HTBW=`echo "${LINE}" | sed -n 's/^.*HTBW=//gp' | sed -n 's/;.*$//gp'`
    if [ -z "$HTBW" ]; then
        echo "No HTBW"
        exit 1
    fi
#   echo "HTBW is $HTBW"
    /userfs/bin/tcapi set Info_WLan11ac APHTBW $HTBW


#	Loop data line
CUR_LINE=3
while [ "$CUR_LINE" -le "$TOTAL_LINE" ];do
	# Get the line
	LINE=`sed -n "${CUR_LINE}p" $DATA_FILE`
	if [ -z "$LINE" ]; then
		echo "Invalid line"
		exit 1
	fi
#	echo "LINE is $LINE"
	# Get mac
	MAC=`echo "${LINE}" | sed -n 's/^.*MAC=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$MAC" ]; then
		echo "No mac"
		exit 1
	fi
#	echo "MAC is $MAC"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`MAC $MAC
	
	LeaseNum=`/userfs/bin/tcapi get DhcpLease LeaseNum`
#	echo "LeaseNum is $LeaseNum"
	LeaseNum=`expr $LeaseNum - 1`
	CUR_Num=0
	while [ "$CUR_Num" -le "$LeaseNum" ];do
		MAC_TMP=`/userfs/bin/tcapi get DhcpLease_Entry"$CUR_Num" MAC`
#		echo "MAC_TMP is $MAC_TMP"
		if [ "$MAC" = "$MAC_TMP" ];then
			IP=`/userfs/bin/tcapi get DhcpLease_Entry"$CUR_Num" IP`
			HostName=`/userfs/bin/tcapi get DhcpLease_Entry"$CUR_Num" HostName`
			
			/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`IP $IP
			/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`HostName $HostName
		fi
		CUR_Num=`expr $CUR_Num + 1`
	done
	
	# Get wmm
	WMM=`echo "${LINE}" | sed -n 's/^.*WMM=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$WMM" ]; then
		echo "No WMM"
		exit 1
	fi
#	echo "WMM is $WMM"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`WMM $WMM
	
	# Get PhMd
	TYPE=`echo "${LINE}" | sed -n 's/^.*PhMd=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$TYPE" ]; then
		echo "No type"
		exit 1
	fi
#	echo "TYPE is $TYPE"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TYPE $TYPE
	
	# Get BW
	BW=`echo "${LINE}" | sed -n 's/^.*BW=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$BW" ]; then
		echo "No BW"
		exit 1
	fi
#	echo "BW is $BW"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`BW $BW
	
	# Get SGI
	SGI=`echo "${LINE}" | sed -n 's/^.*SGI=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$SGI" ]; then
		echo "No SGI"
		exit 1
	fi
#	echo "SGI is $SGI"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`SGI $SGI
	
	# Get STBC
	STBC=`echo "${LINE}" | sed -n 's/^.*STBC=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$STBC" ]; then
		echo "No STBC"
		exit 1
	fi
#	echo "STBC is $STBC"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`STBC $STBC
	
	# Get Rate
	RATE=`echo "${LINE}" | sed -n 's/^.*Rate=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$RATE" ]; then
		echo "No rate"
		exit 1
	fi
#	echo "Rate is $RATE"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`Rate $RATE
	
	# Get TXP
	TXP=`echo "${LINE}" | sed -n 's/^.*TXP=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$TXP" ]; then
		echo "No TXP"
		exit 1
	fi
#	echo "TXP is $TXP"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TXP $TXP
	
	# Get RXP
	RXP=`echo "${LINE}" | sed -n 's/^.*RXP=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$RXP" ]; then
		echo "No RXP"
		exit 1
	fi
#	echo "RXP is $RXP"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RXP $RXP
	
	# Get TXB
	TXB=`echo "${LINE}" | sed -n 's/^.*TXB=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$TXB" ]; then
		echo "No TXB"
		exit 1
	fi
#	echo "TXB is $TXB"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TXB $TXB
	
	# Get RXB
	RXB=`echo "${LINE}" | sed -n 's/^.*RXB=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$RXB" ]; then
		echo "No RXB"
		exit 1
	fi
#	echo "RXB is $RXB"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RXB $RXB
	
	# Get SIG
	SIG=`echo "${LINE}" | sed -n 's/^.*SIG=//gp' | sed -n 's/;.*$//gp'`
	if [ -z "$SIG" ]; then
		echo "No SIG"
		exit 1
	fi
#	echo "SIG is $SIG"
	/userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`SIG $SIG

        # Get RSSI
        RSSI=`echo "${LINE}" | sed -n 's/^.*RSSI=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$RSSI" ]; then
                echo "No RSSI"
                exit 1
        fi
#       echo "RSSI is $RSSI"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RSSI $RSSI

        # Get StayTime
        StayTime=`echo "${LINE}" | sed -n 's/^.*StayTime=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$StayTime" ]; then
                echo "No StayTime"
                exit 1
        fi
#       echo "StayTime is $StayTime"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`StayTime $StayTime

        # Get TxRate
        TxRate=`echo "${LINE}" | sed -n 's/^.*TxRate=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$TxRate" ]; then
                echo "No TxRate"
                exit 1
        fi
#       echo "TxRate is $TxRate"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TxRate $TxRate

        # Get RxRate
        RxRate=`echo "${LINE}" | sed -n 's/^.*RxRate=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$RxRate" ]; then
                echo "No RxRate"
                exit 1
        fi
#       echo "RxRate is $RxRate"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RxRate $RxRate

        # Get TxSucPkt
        TxSucPkt=`echo "${LINE}" | sed -n 's/^.*TxSucPkt=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$TxSucPkt" ]; then
                echo "No TxSucPkt"
                exit 1
        fi
#       echo "TxSucPkt is $TxSucPkt"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TxSucPkt $TxSucPkt

        # Get TxFailPkt
        TxFailPkt=`echo "${LINE}" | sed -n 's/^.*TxFailPkt=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$TxFailPkt" ]; then
                echo "No TxFailPkt"
                exit 1
        fi
#       echo "TxFailPkt is $TxFailPkt"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`TxFailPkt $TxFailPkt

        # Get RxSucPkt
        RxSucPkt=`echo "${LINE}" | sed -n 's/^.*RxSucPkt=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$RxSucPkt" ]; then
                echo "No RxSucPkt"
                exit 1
        fi
#       echo "RxSucPkt is $RxSucPkt"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RxSucPkt $RxSucPkt

        # Get RxFailPkt
        RxFailPkt=`echo "${LINE}" | sed -n 's/^.*RxFailPkt=//gp' | sed -n 's/;.*$//gp'`
        if [ -z "$RxFailPkt" ]; then
                echo "No RxFailPkt"
                exit 1
        fi
#       echo "RxFailPkt is $RxFailPkt"
        /userfs/bin/tcapi set Info_WLan11ac Sta`expr $CUR_LINE - 3`RxFailPkt $RxFailPkt		
		
	CUR_LINE=`expr $CUR_LINE + 1`
done

