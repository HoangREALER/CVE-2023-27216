#!/bin/sh

PacketFILE="/var/tmp/packet_5g.cfg"
/userfs/bin/iwpriv ath0 txrx_fw_stats 8
/bin/dmesg > /var/tmp/packet_5g.cfg

#  Check data file
if [ -z "$PacketFILE" ]; then
    echo "No data file to process"
    exit 1
fi
if [ ! -f "$PacketFILE" ]; then
    echo "$PacketFILE no exist"
    exit 1
fi

#  Get line number of data file
All_LINE=`sed -n "$=" $PacketFILE`

#  Loop data line
CUR_LINE=`expr $All_LINE - 11`
    
while [ "$CUR_LINE" -le "$All_LINE" ];do

    TXRXLINE=`sed -n "${CUR_LINE}p" $PacketFILE`

    #Get TxFrame
    FindTX=`echo "$TXRXLINE" | grep "Tx pkts completed"`
    if [ ! -z "$FindTX" ];then
        wlanTxFrames=`echo "${FindTX}" | awk '{print $5}'`
        /userfs/bin/tcapi set Info_WLan11ac wlanTxFrames $wlanTxFrames
    fi

    #Get TxByte
    FindTXByte=`echo "$TXRXLINE" | grep "Tx bytes completed"`
    if [ ! -z "$FindTXByte" ];then
        wlanTxBytes=`echo "${FindTXByte}" | awk '{print $5}'`
        /userfs/bin/tcapi set Info_WLan11ac wlanTxBytes $wlanTxBytes
    fi

    #Get RxFrame
    FindRX=`echo "$TXRXLINE" | grep "Rx pkts completed"`
    if [ ! -z "$FindRX" ];then
        wlanRxFrames=`echo "${FindRX}" | awk '{print $5}'`
        /userfs/bin/tcapi set Info_WLan11ac wlanRxFrames $wlanRxFrames
    fi

    #Get RxByte
    FindRXByte=`echo "$TXRXLINE" | grep "Rx bytes completed"`
    if [ ! -z "$FindRXByte" ];then
        wlanRxBytes=`echo "${FindRXByte}" | awk '{print $5}'`
        /userfs/bin/tcapi set Info_WLan11ac wlanRxBytes $wlanRxBytes
    fi
    
    CUR_LINE=`expr $CUR_LINE + 1`
done
