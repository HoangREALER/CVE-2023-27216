#!/bin/sh

USB_DEV=/tmp/mnt/dev
USB_MNT=/tmp/mnt/usb1_1
LOCK_FILE=/tmp/usbcheck.tmp

#Allow one process only
if [ -f "$LOCK_FILE" ]; then
	exit 0
else
	echo "0" > $LOCK_FILE
fi

#Check if usb is mounted first
RET=`mount | sed -n /sd/p | sed -n /usb/p`
if [ -z "$RET" ]; then
	rm -f $LOCK_FILE
	exit 0
fi

FILES=`ls $USB_DEV`

if [ -z "$FILES" ] && [ -d "$USB_MNT" ]; then
	echo "usb is unplugged but mounted"
	umount $USB_MNT
	rm -rf $USB_MNT
fi

rm -f $LOCK_FILE
