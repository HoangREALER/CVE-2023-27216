#!/bin/sh
# modify by lala
while [ 1 = 0 ]
do
    usb_status=`cat /proc/usb_enable`
    if [ "$usb_status" = "1" ]; then
	dlna_enable=`userfs/bin/tcapi get DMS_Entry Enable`
	if [ "$dlna_enable" = "Yes" ]; then
	    dlna_active=`userfs/bin/tcapi get Info_WLan dlnaactive`
	    dlna_media_name_change=`cat /tmp/mnt/dlna_media_name_change`
	    if [ "$dlna_active" != "1" ] || [ "$dlna_media_name_change" != "1" ]; then
		sleep 1
                usb_serial_status=`cat proc/tc3162/usb_serial_status`
                if [ "$usb_serial_status" != "1" ]; then
                    DlnaPath=`/userfs/bin/tcapi get DMS_Basic Path`
                    echo $DlnaPath
                    ln -s /tmp/mnt/usb1_1/ $DlnaPath
                    userfs/bin/tcapi set Info_WLan dlnaactive 1
                    echo 1 > /tmp/mnt/dlna_media_name_change
                    /usr/script/dms_start.sh /etc/dms_device.cfg /etc/dms_basic.cfg
		fi
	    fi
	fi
    elif [ "$usb_status" = "0" ]; then
	if [ "$dlna_active" = "1" ]; then
	    kill -SIGTERM `cat /var/run/dms.pid`
	    userfs/bin/tcapi set Info_WLan dlnaactive 0
	fi
    fi
    sleep 1
done

