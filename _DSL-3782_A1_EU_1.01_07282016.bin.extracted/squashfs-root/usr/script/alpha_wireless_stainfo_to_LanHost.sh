#!/bin/sh

DATA_FILE="/var/tmp/stainfott_to_LanHost.cfg"

/userfs/bin/iwpriv ra0 ar9_show stainfott > /var/tmp/stainfott_to_LanHost.cfg

rm /tmp/LanType

#Check data file

if [ -z "$DATA_FILE" ]; then
    echo "No data file to process"
    exit 1
fi

if [ ! -f "$DATA_FILE" ]; then
    echo "$DATA_FILE no exist"
    exit 1
fi

#Get line number of data file

TOTAL_LINE=`sed -n "$=" $DATA_FILE`
TOTAL_LINE=`expr $TOTAL_LINE - 1`

LINE=`sed -n "2p" $DATA_FILE`

CUR_LINE=3

while [ "$CUR_LINE" -le "$TOTAL_LINE" ];do
    
    # Get the line
    LINE=`sed -n "${CUR_LINE}p" $DATA_FILE`

    if [ -z "$LINE" ]; then
        echo "Invalid line"
        exit 1
    fi

    # Get mac
    MAC=`echo "${LINE}" | sed -n 's/^.*MAC=//gp' | sed -n 's/;.*$//gp'`

    if [ -z "$MAC" ]; then
        echo "No mac"
        exit 1
    fi

    # Get PhMd
    TYPE=`echo "${LINE}" | sed -n 's/^.*PhMd=//gp' | sed -n 's/;.*$//gp'`

    if [ -z "$TYPE" ]; then
        echo "No type"
        exit 1
    fi

    if [ "$TYPE" = "HTMIX" ]; then
        TYPE="g/n"
    elif [ "$TYPE" = "CCK" ]; then
        TYPE="b"
    elif [ "$TYPE" = "OFDM" ]; then
        TYPE="g"
    else
        TYPE="n"
    fi

    LeaseNum1=`/userfs/bin/tcapi get LanHost LeaseNum`
    LeaseNum1=`expr $LeaseNum1 - 1`

    CUR_Num1=0

    while [ "$CUR_Num1" -le "$LeaseNum1" ];do

        MAC_TMP1=`/userfs/bin/tcapi get LanHost_Entry"$CUR_Num1" MAC`
        MAC_TMP1=`echo ${MAC_TMP1} | sed 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`

        if [ "$MAC" = "$MAC_TMP1" ];then
            echo $MAC $TYPE >> /tmp/LanType
            /userfs/bin/tcapi set LanHost_Entry"$CUR_Num1" TYPE $TYPE
            /userfs/bin/tcapi set LanHost_Entry"$CUR_Num1" InterfaceType "802.11"
        fi

        CUR_Num1=`expr $CUR_Num1 + 1`
    done

    CUR_LINE=`expr $CUR_LINE + 1`

done

