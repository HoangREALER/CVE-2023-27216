PROFILE_CFG=/userfs/profile.cfg
if [ -f $PROFILE_CFG ] ; then
    chmod 777 $PROFILE_CFG
    . $PROFILE_CFG
fi
iptables -t filter -N ipfilter_chain
if [ "$ALPHA_MACFILTER_FUNC" != "" ] ;then
iptables -t filter -N macfilter_chain
fi
iptables -t filter -N app_filter_chain
iptables -t filter -N url_filter_chain
if [ "$TCSUPPORT_TIME_OF_DAY" != "" ] ;then
iptables -t filter -N parent_control_chain
fi
if [ "$TCSUPPORT_OBM_FW" != "" ] ;then
iptables -t filter -N FW_W2L
iptables -t filter -N FW_L2W
fi

if [ "$ALPHA_IPFILTER_FUNC" != "" ] ;then
iptables -t filter -A FORWARD -i br+ -j ipfilter_chain
iptables -t filter -A FORWARD -i ra+ -j ipfilter_chain
else
iptables -t filter -A FORWARD -j ipfilter_chain
fi
if [ "$ALPHA_MACFILTER_FUNC" != "" ] ;then
iptables -t filter -A FORWARD -i br+ -j macfilter_chain
iptables -t filter -A FORWARD -i ra+ -j macfilter_chain
fi
if [ "$ALPHA_URLFILTER_FUNC" != "" ] ;then
iptables -t filter -A FORWARD -i br+ -p TCP -m multiport --dport http -j url_filter_chain
iptables -t filter -A FORWARD -i ra+ -p TCP -m multiport --dport http -j url_filter_chain
else
iptables -t filter -A FORWARD -p TCP -m multiport --dport http -j url_filter_chain
fi
iptables -t filter -A FORWARD -p TCP -j app_filter_chain
iptables -t filter -A FORWARD -p UDP -j app_filter_chain
if [ "$TCSUPPORT_TIME_OF_DAY" != "" ] ;then
iptables -t filter -A FORWARD -p TCP -j parent_control_chain
iptables -t filter -A FORWARD -p UDP -j parent_control_chain
fi
if [ "$TCSUPPORT_OBM_FW" != "" ] ;then
iptables -t filter -A FORWARD -o br0 -j FW_W2L
iptables -t filter -A FORWARD -i br0 -j FW_L2W
fi
#krammer
iptables -t filter -N SPI
iptables -t filter -N SPI_FW
iptables -t filter -N ACL
iptables -t filter -N FIREWALL
if [ "$TCSUPPORT_OBM_FW" != "" ] ;then
iptables -t filter -N FW_W2W
iptables -t filter -N FW_L2L
fi
if [ "$TCSUPPORT_MULTI_NAT" != "" ] ;then
iptables -t filter -N ADDRMAP_FORWARD
fi
if [ "$TCSUPPORT_DHCP_PORT_FLT" != "" ] ;then
iptables -t filter -N DHCP_PORT_FLT
fi
iptables -t filter -A INPUT -j SPI
iptables -t filter -A INPUT -j ACL ! -i lo
if [ "$TCSUPPORT_DHCP_PORT_FLT" != "" ] ;then
iptables -t filter -A INPUT -j DHCP_PORT_FLT
fi
iptables -t filter -A INPUT -j FIREWALL

#create a new chain
if [ "$TCSUPPORT_PORT_TRIGGER" != "" ] ;then
iptables -t filter -N FORWARD_WAN
fi

if [ "$TCSUPPORT_MULTI_NAT" != "" ] ;then
iptables -t filter -I FORWARD 1 -j ADDRMAP_FORWARD
if [ "$TCSUPPORT_WAN_ETHER" != "" ] ;then
	pvc_num="0 1 2 3 4 5 6 7 8 9 10"
elif [ "$TCSUPPORT_WAN_PTM" != "" ] ;then
	pvc_num="0 1 2 3 4 5 6 7 8 9"
else
	pvc_num="0 1 2 3 4 5 6 7"
fi

for j in $pvc_num
do
	iptables -t filter -N ADDRMAP_FORWARD$j
done					
fi

if [ "$ALPHA_FIREWALL_FUNC" != "" ] ;then
iptables -t filter -N PRE_FW
iptables -t nat -N WAN_PASS
iptables -t filter -N SPI_FW
iptables -t filter -N DOS_FW
iptables -t filter -N DOS_TCP
iptables -t filter -N DOS_PIN

iptables -t filter -A INPUT -j PRE_FW
fi
if [ "$ALPHA_MACFILTER_FUNC" != "" ] ;then

iptables -t filter -N macfilter_chain
iptables -t filter -A FORWARD -i br+ -j macfilter_chain
iptables -t filter -A FORWARD -i ra+ -j macfilter_chain
fi

iptables -t filter -N PRE_SERVICE
iptables -t filter -A FORWARD -j PRE_SERVICE
