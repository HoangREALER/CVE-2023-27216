#!/bin/sh

PID_FILE="/tmp/var/run/syslogd.pid"
LOG_FILE="/tmp/var/log/messages"
LOG_FILE_CUR="/tmp/var/log/currLogFile"

#Check parameter
if [ 0 -eq $# ]; then
  echo "Usage: *.sh clear|off|type(sdapn) [ip]"
  exit 0
fi

# clear log
if [ "clear" = $1 ]; then
  echo "" > $LOG_FILE
  echo "" > $LOG_FILE_CUR
  exit 0
fi

# kill syslogd
if [ -f $PID_FILE ]; then
  PID=`cat $PID_FILE`
  if [ $PID != 0 ]; then
    kill -9 $PID
  fi
  rm -f $PID_FILE
else
  killall -9 syslogd
fi

#stop syslogd
if [ "off" = $1 ]; then
  exit 0
fi

# Check log type
TYPE=$1
OPTS=""
TMP=`echo $TYPE | sed -n '/s/p'`
if [ -n "$TMP" ]; then
  OPTS=$OPTS" -F sysact"
fi

TMP=`echo $TYPE | sed -n '/d/p'`
if [ -n "$TMP" ]; then
  OPTS=$OPTS" -F debug"
fi

TMP=`echo $TYPE | sed -n '/a/p'`
if [ -n "$TMP" ]; then
  OPTS=$OPTS" -F attack"
fi

TMP=`echo $TYPE | sed -n '/p/p'`
if [ -n "$TMP" ]; then
  OPTS=$OPTS" -F drop"
fi

TMP=`echo $TYPE | sed -n '/n/p'`
if [ -n "$TMP" ]; then
  OPTS=$OPTS" -F notice"
fi
#echo $OPTS
#if nothing needs log then quit
if [ -z "$OPTS" ]; then
  exit 0
fi


#Check remote ip
REMOTE_IP=$2
if [ -n "$REMOTE_IP" ]; then
  OPTS=$OPTS" -R "$REMOTE_IP
fi

syslogd $OPTS &
echo $! > $PID_FILE
exit 0
