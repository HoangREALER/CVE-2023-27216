#!/bin/sh
# vi: set sw=4 ts=4:
#
# MFC Manufacture tool program
#

case "$1" in
led_power)
	case "$2" in
	red)
		echo "1" > /proc/tc3162/led_power
		;;
	green)
		echo "2" > /proc/tc3162/led_power
		;;
	off)
		echo "0" > /proc/tc3162/led_power
		;;
	esac
	;;
led_dsl)
	case "$2" in
	on)
		echo "1" > /proc/tc3162/led_dsl
		;;
	off)
		echo "0" > /proc/tc3162/led_dsl
		;;
	esac
	;;
led_internet)
	case "$2" in
	green)
		echo "1 1" > /proc/tc3162/led_internet
		;;
	red)
		echo "0 1" > /proc/tc3162/led_internet
		;;
	off)
		echo "0 0" > /proc/tc3162/led_internet
		;;
	esac
	;;
led_usb)
	case "$2" in
	on)
		echo "1" > /proc/tc3162/led_usb
		;;
	off)
		echo "0" > /proc/tc3162/led_usb
		;;
	esac
	;;
led_youview)
	case "$2" in
	blink)
	echo "0 2" > /proc/tc3162/led_youview
		;;
	on)
		echo "0 1" > /proc/tc3162/led_youview
		;;
	off)
		echo "0 0" > /proc/tc3162/led_youview
		;;
	esac
	;;
led_wps)
	case "$2" in
	on)
		echo "1" > /proc/tc3162/led_wps
		;;
	off)
		echo "0" > /proc/tc3162/led_wps
		;;
	esac
	;;
wlan)
	case "$2" in
	init)
		if [ $# -lt 4 ]; then
                    echo "Usage:"
                    echo "mfc wlan init <psk> <password> <countrycode>"
		    echo "mfc wlan show"
		    exit 1
		fi

		if [ `expr length $3` != 16 ] || [ `expr length $4` != 16 ] || [ `expr length "$5"` -ge 30 ]; then
		    echo "Error: psk length must be 16, password lenth must be 16, country code must be less than 30."
		    exit 1
		fi

		str="####################"
		echo  "$str$str$str$str$str" > /tmp/writeinf
		mtd writeflash /tmp/writeinf 86 198145 reservearea

		echo -e "psk=$3 pw=$4 countrycode=$5\n" > /tmp/writeinf
		mtd writeflash /tmp/writeinf 86 198145 reservearea
		;;
	show)
		mtd readflash /tmp/readinf 86 198145 reservearea
		echo "##################################################"
		echo -e "\n"
		echo "`cat /tmp/readinf  | grep psk | cut -f1`"
		echo -e "\n"
		echo "##################################################"
		;;
	esac
	;;
*)
	echo "Usage: mfc {command} <params>"
	echo "Commands:"
	echo ""
	echo "     led_power red/green/off    Turn on power led for red or green."
	echo "     led_dsl   on               Turn on dsl   led."
	echo "     led_internet red/green/off Turn on internet led for red/green."
	echo "     led_usb   on               Turn on usb   led."
	echo "     led_youview   blink/on/off Turn on youview   led."
	echo "     led_wps   on               Turn on wps   led."
	echo "     wlan init <psk> <countrycode>"
	echo ""
	;;
esac
exit 0
