var array2Dv;
var Total_Clients = 0;
var Time_ClientList;
var Get__MACAddress;
var Get__ReserveIP;
var cliFlag = false;

var StaticRules = 32;
var dhcpClient = new Array();
var staticClient = new Array();
var ClientList = new Array();

var staticClient_count = 0;

var lan0_ip = "";
var dhcp_range_start = "";
var dhcp_pool_count = "";

function copyArray(arr){
	var newArray = new Array();
	for (var i = 0; i < arr.length; i++) {
		newArray.push(arr[i]);
	}
	return newArray;
}

function decodeSpecialChr(str) {
	str = str.replace(/&amp;/g, "&");
	str = str.replace(/&lt;/g, "<");
	str = str.replace(/&gt;/g, ">");
	str = str.replace(/&quot;/g, "\"");
	str = str.replace(/&#39;/g, "'");
	str = str.replace(/&#59;/g, ";");
	str = str.replace(/&#61;/g, "=");
	str = str.replace(/&#43;/g, "+");
	str = str.replace(/&#45;/g, "-");
	return str;
}

function Get_ClientInfo(a) {
	Time_GetConnectionUpTime = window.clearInterval(Time_GetConnectionUpTime);
	Time_GetDSLLinkStatus = window.clearInterval(Time_GetDSLLinkStatus);
	if(cliFlag == true)
		return;
	$.get("/cgi-bin/get/New_GUI/home_clientList.cgi", function(){
		dhcpClient = new Array();
		for(var i = 0; i < Total_Clients; i++) {
			var client = new Array();
			client.push(eval("dhcpClient"+i+"_ip"));
			client.push(eval("dhcpClient"+i+"_mac"));
			client.push(eval("dhcpClient"+i+"_hostname"));
			client.push(eval("dhcpClient"+i+"_type"));
			client.push(eval("dhcpClient"+i+"_add"));
			client.push(eval("dhcpClient"+i+"_active"));
			
			dhcpClient.push(client);
		}
		$.get("/cgi-bin/get/New_GUI/home_clientList.asp", function(){

		staticClient_count = 0;
		staticClient = new Array();
		for(var i = 0; i < StaticRules; i++) {
			var client = new Array();
			client.push(eval("dhcpStatic"+i+"_ip"));
			client.push(eval("dhcpStatic"+i+"_mac"));
			client.push(eval("dhcpStatic"+i+"_active"));
			client.push(eval("dhcpStatic"+i+"_hostname"));
			client.push(0);

			if(eval("dhcpStatic"+i+"_mac") != "N/A")
				staticClient_count++;				
			
			staticClient.push(client);
		}

		// dhcpip, staticip, mac, hostname, type, add, active
		ClientList = new Array();		
		for(var i = 0; i < dhcpClient.length; i++) {
			var flag = true;
			for(var z = 0; z < staticClient.length; z++) {
				if(staticClient[z][1] == "N/A")
					continue;

				if(dhcpClient[i][1].toUpperCase() == staticClient[z][1].toUpperCase()) {

					flag = false;

					staticClient[z][4] = 1;
					var client = new Array();
					client.push(dhcpClient[i][0]);					// dhcpip
					client.push(staticClient[z][0]);				// staticip
					client.push(dhcpClient[i][1].toUpperCase());	// mac

					if(staticClient[z][3] != "N/A")
						client.push(staticClient[z][3]);					// hostname
					else
						client.push(dhcpClient[i][2]);					// hostname

					if(dhcpClient[i][3].indexOf("Ethernet") != -1)
						client.push("LAN");							// type
					else if(dhcpClient[i][3].indexOf("802.11ac") != -1)
						client.push("WiFi_5G");					// type
					else if(dhcpClient[i][3].indexOf("802.11n") != -1)
						client.push("WiFi_2.4G");					// type
					else
						client.push("-");							// type
					
					client.push(dhcpClient[i][4]);					// add
					client.push(dhcpClient[i][5]);					// active
					client.push(z);									// StaticClient z
					
					ClientList.push(client);
				}
			}	

			if(flag) {
				var client = new Array();
				client.push(dhcpClient[i][0]);						// dhcpip
				client.push("");									// staticip
				client.push(dhcpClient[i][1].toUpperCase());		// mac
				client.push(dhcpClient[i][2]);						// hostname
				
				if(dhcpClient[i][3].indexOf("Ethernet") != -1)
					client.push("LAN");								// type
				else if(dhcpClient[i][3].indexOf("802.11ac") != -1)
						client.push("WiFi_5G");					// type
				else if(dhcpClient[i][3].indexOf("802.11") != -1)
					client.push("WiFi_2.4G");						// type
				else
					client.push("-");								// type
				
				client.push(dhcpClient[i][4]);						// add
				client.push(dhcpClient[i][5]);						// active
				client.push(-1);									// StaticClient z
				
				ClientList.push(client);
			}
		}		

		var static_count = 0;

		for (var i = 0; i < staticClient.length; i++) {
			if(staticClient[i][1] == "N/A")
				continue;

			if(staticClient[i][4] != 0)
				continue;

			static_count++;

			var client = new Array();
			client.push(staticClient[i][0]);
			client.push(staticClient[i][0]);
			client.push(staticClient[i][1]);
			if(staticClient[i][3] != "N/A")
				client.push(staticClient[i][3]);
			else
				client.push("");
			client.push("");
			client.push("DHCP_STATIC");
			client.push("");
			client.push(i);	
			ClientList.push(client);			
		}

		var a = 0,
		c = 0;

		$("#Total_ConnectedClients").html(Total_Clients);

		Total_Clients = Total_Clients + static_count;

		array2Dv = new Array2DVar(Total_Clients, 14);		

		// ClientList: dhcpip, staticip, mac, hostname, type, add, active
		for(var i = 0; i < Total_Clients; i++) {
			array2Dv[i][11] = "";

			try {
				array2Dv[i][10] = ClientList[i][4];
			} catch (e) {
				continue;
			}

			array2Dv[i][0]  = ClientList[i][3];
			array2Dv[i][1]  = ClientList[i][2];
			array2Dv[i][2]  = ClientList[i][0];
			array2Dv[i][3]  = "";
			array2Dv[i][9]  = "";
			array2Dv[i][5]  = ClientList[i][1];
			array2Dv[i][12]  = ClientList[i][5];
			array2Dv[i][13]  = ClientList[i][7];

			var x = array2Dv[i][1].split(/[\s:]+/);
			var l = x[x.length - 6];
			var h = x[x.length - 5];
			var g = x[x.length - 4];
			var r = l + h + g;
			var b = r.toUpperCase();
			if (allText.match(b) == b) {
				var e = allText.indexOf(b) + 7;
				var m = allText.substring(e).split(/[\s,]+/);
				array2Dv[i][4] = decode_char_text(m[0]);
			} else {
				array2Dv[i][4] = "Unknown Vendor";
			}
			if (array2Dv[i][3] == "") {
				array2Dv[i][3] = "";
			}
		}
		
		for (var y = 0; y < Total_Clients; y++) {
			if (array2Dv[y][10] == "LAN") {
				array2Dv[y][6] = I18N("j", m_comm_disenable);
				array2Dv[y][7] = "#000000";
				array2Dv[y][8] = "link_IconE_Allow";
			} else {
				if (array2Dv[y][10] == "WiFi_2.4G" || array2Dv[y][10] == "WiFi_2.4G_Guest") {
					array2Dv[y][6] = I18N("j", m_comm_disenable);
					array2Dv[y][7] = "#000000";
					array2Dv[y][8] = "link_IconW_Allow";
				} else if (array2Dv[y][10] == "WiFi_5G" || array2Dv[y][10] == "WiFi_5G_Guest") {
					array2Dv[y][6] = I18N("j", m_comm_disenable);
					array2Dv[y][7] = "#000000";
					array2Dv[y][8] = "link_Icon5W_Allow";
				}
			}
		}

		ShowClient_List(Total_Clients);
	}, 'script');
	}, 'script');
	
}

function ShowClient_List(d) {
	$(document).tooltip("disable");
	$(document).tooltip("enable");
	var e = "";
	var h = 0;
	var g = d;
	e = '<table class="block" border="0" ondragstart="return false" onselectstart="return false" width="900px">';
	e += "<tbody>";
	e += "<tr>";
	if (d != 0) {
		document.getElementById("Client_Info").style.display = "none";
		document.getElementById("Client_Group").style.display = "table-row";

		for (var f = 1; f <= (g + 1); f++) {
			if(f == (g + 1)) {
				e += "<td>"
				   + '<div class ="client_add_Tag" onclick ="addData()" style ="cursor:pointer">'
				   + "</div>"
				   +"</td>";
				if (f % 3 == 0)
					e += "</tr>";
				break;
			}

			var a = array2Dv[h][0];
			var j = array2Dv[h][1];
			var c = array2Dv[h][2];
			var k = array2Dv[h][3];
			var n = array2Dv[h][4];
			var o = array2Dv[h][6];
			var b = array2Dv[h][7];
			var p = array2Dv[h][8];
			var l = array2Dv[h][9];
			var i = array2Dv[h][12];
			
			if (typeof(j) == "undefined" || j.length == 0) {
				break;
			}
			if (a == 0) {
				a = "Unknown";
			}
			if (l != 0) {
				a = l;
			}
			if (f % 3 != 0) {
				ClientNumber = f;
				e += "<td>";
				e += '<div class ="client_Tag" style ="cursor:default">';
				e += '<div class ="' + p + '"></div>';
				e += '<div class ="client_Info">';
				e += '<div class ="client_Name">' + a + "</div>";
				if(i == "DHCP")
					e += '<div class ="client_EditImage" onclick ="client_EditMember(' + ClientNumber + ')" style ="cursor:pointer"></div>';
				else if(i == "DHCP_STATIC")
					e += '<div class ="client_EditImage" onclick ="client_EditMember_STATIC(' + ClientNumber + ')" style ="cursor:pointer"></div>';

				if(i != "DHCP_STATIC")
					e += '<div class ="client_Vender">' + n + "</div>";
				e += '<div class ="client_IPv4Address">' + c + "</div>";
				e += '<div class ="client_MACAddress" id="mac_addr_' + ClientNumber + '">' + j + "</div>";
				e += "</div>";
				e += "</div>";
				e += "</td>";
			} else {
				ClientNumber = f;
				e += "<td>";
				e += '<div class ="client_Tag" style ="cursor:default">';
				e += '<div class ="' + p + '"></div>';
				e += '<div class ="client_Info">';
				e += '<div class ="client_Name">' + a + "</div>";
				if(i == "DHCP")
					e += '<div class ="client_EditImage" onclick="client_EditMember(' + ClientNumber + ')" style="cursor:pointer"></div>';
				else if(i == "DHCP_STATIC")
					e += '<div class ="client_EditImage" onclick ="client_EditMember_STATIC(' + ClientNumber + ')" style ="cursor:pointer"></div>';
				if(i != "DHCP_STATIC")
					e += '<div class ="client_Vender">' + n + "</div>";
				e += '<div class ="client_IPv4Address">' + c + "</div>";
				e += '<div class ="client_MACAddress" id="mac_addr_' + ClientNumber + '">' + j + "</div>";
				e += "</div>";
				e += "</div>";
				e += "</td>";
				e += "</tr>";
			}
			h++;
		}
		if (Total_Clients % 3 == 1) {
			e += "<td>";
			e += "</td>";
			e += "</tr>";
		}
	} else {
		if (d == 0) {
			$("#Client_Group").removeClass('Loading_pop_image3');
			document.getElementById("Client_Info").style.display = "table-row";
			document.getElementById("Client_Group").style.display = "none";
		}
	}
	e += "</tbody>";
	e += "</table>";
	$("#Client_Group").removeClass('Loading_pop_image3');
	document.getElementById("Client_Group").innerHTML = e;
	document.getElementById("CreatePopAlertMessage").style.display = "none";
	document.getElementById("cliMessage").style.display = "none";
	Time_ClientList = setTimeout("ClearAndRenew()", 1000);
}

function addData() {
	cliFlag = true;
	clearInterval(Time_GetStatusXML);
	$(".popTitle").html(m_comm_addrule);
	$("#check_btn").attr("class", "styled_button_dis").prop("disabled", true)
		.off('click').click(function() {
			document.getElementById("client_Name").value = document.getElementById("client_Name").value.replace(/[^a-zA-Z0-9-_ ]/g, '');
			closeAddPOP();
		});

	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");

	$("#show_Vendor").hide();
	$("#client_MACAddress").hide();
	$("#show_editMac").show();
	$("#show_IPAdr").hide();

	$("#show_IPAdrReserve").show();
	$("#show_ReserveIP").hide();

	presetCheckBox("enableAccess", false);
	document.getElementById("TimmyCheckBox2").checked = true;

	$("#editPop").show();

	editType = false;
	editID = "";

	$("#client_Name").val("");
	$("#client_IPAdrReserve").val("");
	$("#client_editMac").val("");
}

function client_EditMember_STATIC(b) {
	cliFlag = true;
	clearInterval(Time_GetStatusXML);
	$(".popTitle").html(m_comm_EditRule);
	var f = document.getElementById("schedule");
	var a = array2Dv[b - 1][0];
	var h = array2Dv[b - 1][1];
	var c = array2Dv[b - 1][2];
	var j = array2Dv[b - 1][3];
	var n = array2Dv[b - 1][4];
	var g = array2Dv[b - 1][5];
	var o = array2Dv[b - 1][6];
	var k = array2Dv[b - 1][9];
	var d = array2Dv[b - 1][8];
	var l = array2Dv[b - 1][11];

	$("#check_btn").attr("class", "styled_button_dis").prop("disabled", true)
		.off('click').click(function() {
			closeEditPOP_Static(array2Dv[b - 1][13]);
		});

	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");

	$("#show_Vendor").hide();
	$("#client_MACAddress").hide();
	$("#show_editMac").show();
	$("#show_IPAdr").hide();

	$("#show_IPAdrReserve").show();

	presetCheckBox("enableReserveIP", true);
	document.getElementById("TimmyCheckBox2").checked = true;

	$("#editPop").show();

	editType = false;
	editID = "";

	document.getElementById("client_IPAdr").innerHTML = m_comm_notavilable;

	if (d != "link_IconX_Block") {

		document.getElementById("show_ReserveIP").style.display = "table-row";

		if (k != 0) {
			$("#client_Name").val(decodeSpecialChr(k));
		} else {
			$("#client_Name").val(decodeSpecialChr(a));
		}

		document.getElementById("client_IPAdrReserve").value = g;
		document.getElementById("client_editMac").value = h;
	}
}

function closeEditPOP_Static(h) {
	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");
	if(document.getElementById("TimmyCheckBox2").checked) {
		var a = document.getElementById("client_IPAdrReserve").value;
		if (a != "") {
			if (!COMM_ValidV4Format(a) || !COMM_ValidV4Addr(a)) {
				$("#IPAdrReserve_Info").html(m_home_ip_error1);
				return;
			} else {
				var a_list = a.split(".");
				var dhcp_r_list = dhcp_range_start.split(".");

				for(var  i = 0; i < 4; i++) {
					if(i == 3) {
						if((parseInt(a_list[i]) < parseInt(dhcp_r_list[i])) || (parseInt(a_list[i]) > (parseInt(dhcp_r_list[i]) + parseInt(dhcp_pool_count)))) {
							$("#IPAdrReserve_Info").html(m_home_ip_error1);
							return;
						} 
					} else {
						if(a_list[i] != dhcp_r_list[i]) {
							$("#IPAdrReserve_Info").html(m_home_ip_error1);
							return;
						}
					}
				}
				
				$("#IPAdrReserve_Info").html("");
			}
		} else {
			$("#IPAdrReserve_Info").html(m_home_ip_error1);
			return;
		}

		var mac_addr = $("#client_editMac").val();
		if( mac_addr != "") {
			if (mac_addr.search(":") != -1)    
				var tmp=mac_addr.split(":");
			else            
				var tmp=[6];

			if(tmp[0].toString() == "01") {
				$("#MACAddress_Info").html("<br/>"+m_network_error_10);
				return;
			}

			if (!(checkMAC(tmp[0])&&checkMAC(tmp[1])&&checkMAC(tmp[2])&&checkMAC(tmp[3])&&checkMAC(tmp[4])&&checkMAC(tmp[5]))) {
				$("#MACAddress_Info").html("<br/>"+m_network_error_10);
				return;
		    	}
		    	
		    	var tmp_mac_addr = mac_addr.toLocaleLowerCase();
			if(mac_addr=="00:00:00:00:00:00"||tmp_mac_addr=="ff:ff:ff:ff:ff:ff") {
				$("#MACAddress_Info").html("<br/>"+m_network_error_10);
				return;
			}				

			if(mac_addr.indexOf("33:33") == 0) {
				$("#MACAddress_Info").html("<br/>"+m_network_error_10);
				return;
			}

			/*for( var i = 0; i < staticLists.length; i++ ) {
				if(static_modify == i)
					continue;
					
				if( staticLists[i][1] == mac_addr) {
					$("#MACAddress_Info").html("<br/>"+m_network_error_11);
					return;
				}
			}*/
		} else {
			$("#MACAddress_Info").html("<br/>"+m_network_error_10);
			return;
		}

		if(!checkStaticInfo(a, $("#client_editMac").val(), $("#client_Name").val(), h, 0)) {
			return;
		}
	}

	ModifyDHCPTableStatic(h);
}

function checkStaticInfo(u_ip, u_mac, u_hostname, h, dhcp_type) {
	var same_ip = 0;
	var same_mac = 0;
	var same_hostname = 0;

	for (var i = 0; i < staticClient.length; i++) {

		if ( i == parseInt(h) ) 
			continue;

		if(staticClient[i][0].toUpperCase() == u_ip.toUpperCase())
			same_ip++;

		if(staticClient[i][1].toUpperCase() == u_mac.toUpperCase())
			same_mac++;

		if(staticClient[i][3].toUpperCase() == u_hostname.toUpperCase())
			same_hostname++;
	}

	for (var i = 0; i < dhcpClient.length; i++) {
		if( (parseInt(dhcp_type) == 1) && (dhcpClient[i][1].toUpperCase() == u_mac.toUpperCase()) )
			continue;

		if(dhcpClient[i][0].toUpperCase() == u_ip.toUpperCase())
			same_ip++;

		if(dhcpClient[i][1].toUpperCase() == u_mac.toUpperCase())
			same_mac++;

		if(dhcpClient[i][2].toUpperCase() == u_hostname.toUpperCase())
			same_hostname++;
	}

	if(same_ip > 0) {
		$("#IPAdrReserve_Info").html(m_home_ip_error2+u_ip+m_home_ip_error3);
		return false;
	}

	if(same_mac > 0) {
		$("#MACAddress_Info").html(m_comm_mac+" "+u_mac+m_home_ip_error3).show();
		return false;
	}

	return true;
}

var cliNumber = 20;
function Start_reciprocal_Number_cli()
{
	if (cliNumber >= 0)
	{
		cliNumber --;
		setTimeout("Start_reciprocal_Number_cli()", 1000);
	}
	else
	{
		document.getElementById("CreatePopAlertMessage").style.display = "none";
		document.getElementById("cliMessage").style.display = "none";
		cliNumber = 20;
	}
}

function ModifyDHCPTableStatic(static_loc) {
	var data = {};
	if (valueChanged == 1) {
		Get__client_Name = document.getElementById("client_Name").value;
		Get__MACAddress = document.getElementById("client_editMac").value;
		Get__ReserveIP = document.getElementById("client_IPAdrReserve").value;

		if(parseInt(static_loc) >= 0) {
			data.dhcpStaticLabel = static_loc;
		} else {
			data.dhcpStaticLabel = staticClient_count;
		}

		if (!document.getElementById("TimmyCheckBox2").checked && Get__ReserveIP != "") {
			data.dhcpStaticType = "delete";
		}

		if(document.getElementById("TimmyCheckBox2").checked) {
			data.dhcpStaticIP = Get__ReserveIP;
			data.dhcpStaticMAC = Get__MACAddress;
			data.dhcpStaticHostname = Get__client_Name;
		}
		clearCreateRulePOP();
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("cliMessage").style.display = "inline";
		Start_reciprocal_Number_cli();
		setTimeout(function(){
			$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
				data.sessionKey = sessionKey;
				$.ajax({
					type: "POST",
					url: "/cgi-bin/New_GUI/Set/home_clientList.asp",
					data: jQuery.param(data),
					async: false,
					cache: false,
					dataType: "text",
					success: function(msg){
						document.getElementById("check_btn").setAttribute("class", "styled_button_dis");
						document.getElementById("check_btn").disabled = true;
						cliFlag = false;
						ClearAndRenew();
						Time_GetStatusXML = self.setInterval("GetStatusXML()",6000);
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						alert("Save Error!");
					}
				});			
			});
		}, 300);
	} else {
		clearCreateRulePOP();
		ClearAndRenew();
	}	
}

function closeAddPOP()
{
	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");
	var a = document.getElementById("client_IPAdrReserve").value;
	if (a != "") {
		if (!COMM_ValidV4Format(a) || !COMM_ValidV4Addr(a)) {
			$("#IPAdrReserve_Info").html(m_home_ip_error1);
			return;
		} else {
			var a_list = a.split(".");
			var dhcp_r_list = dhcp_range_start.split(".");

			for(var  i = 0; i < 4; i++) {
				if(i == 3) {
					if((parseInt(a_list[i]) < parseInt(dhcp_r_list[i])) || (parseInt(a_list[i]) > (parseInt(dhcp_r_list[i]) + parseInt(dhcp_pool_count)))) {
						$("#IPAdrReserve_Info").html(m_home_ip_error1);
						return;
					}
				} else {
					if(a_list[i] != dhcp_r_list[i]) {
						$("#IPAdrReserve_Info").html(m_home_ip_error1);
						return;
					}
				}
			}
			
			$("#IPAdrReserve_Info").html("");
		}
	} else {
		$("#IPAdrReserve_Info").html(m_home_ip_error1);
		return;
	}

	var mac_addr = $("#client_editMac").val();
	if( mac_addr != "") {
		if (mac_addr.search(":") != -1)    
			var tmp=mac_addr.split(":");
		else            
			var tmp=[6];

		if(tmp[0].toString() == "01") {
			$("#MACAddress_Info").html("<br/>"+m_network_error_10);
			return;
		}

		if (!(checkMAC(tmp[0])&&checkMAC(tmp[1])&&checkMAC(tmp[2])&&checkMAC(tmp[3])&&checkMAC(tmp[4])&&checkMAC(tmp[5]))) {
			$("#MACAddress_Info").html("<br/>"+m_network_error_10);
			return;
	    	}
	    	
	    	var tmp_mac_addr = mac_addr.toLocaleLowerCase();
		if(mac_addr=="00:00:00:00:00:00"||tmp_mac_addr=="ff:ff:ff:ff:ff:ff") {
			$("#MACAddress_Info").html("<br/>"+m_network_error_10);
			return;
		}				

		if(mac_addr.indexOf("33:33") == 0) {
			$("#MACAddress_Info").html("<br/>"+m_network_error_10);
			return;
		}

		/*for( var i = 0; i < staticLists.length; i++ ) {
			if(static_modify == i)
				continue;
				
			if( staticLists[i][1] == mac_addr) {
				$("#MACAddress_Info").html("<br/>"+m_network_error_11);
				return;
			}
		}*/
	} else {
		$("#MACAddress_Info").html("<br/>"+m_network_error_10);
		return;
	}

	if(!checkStaticInfo(a, $("#client_editMac").val(), $("#client_Name").val(), -1)) {
		return;
	}

	ModifyDHCPTableStatic(-1);
}

function client_EditMember(b) {
	cliFlag = true;
	clearInterval(Time_GetStatusXML);
	$(".popTitle").html(m_comm_EditRule);
	var f = document.getElementById("schedule");
	var a = array2Dv[b - 1][0];
	var h = array2Dv[b - 1][1];
	var c = array2Dv[b - 1][2];
	var j = array2Dv[b - 1][3];
	var n = array2Dv[b - 1][4];
	var g = array2Dv[b - 1][5];
	var o = array2Dv[b - 1][6];
	var k = array2Dv[b - 1][9];
	var d = array2Dv[b - 1][8];
	var l = array2Dv[b - 1][11];

	$("#check_btn").attr("class", "styled_button_dis").prop("disabled", true)
		.off('click').click(function() {
			closeEditPOP(array2Dv[b - 1][13]);
		});

	$("#show_editMac").hide();

	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");

	if (d != "link_IconX_Block") {
		document.getElementById("show_Vendor").style.display = "table-row";
		document.getElementById("show_MACAddress").style.display = "table-row";
		document.getElementById("show_ReserveIP").style.display = "table-row";
		document.getElementById("IPAdrReserve_Info").innerHTML = "";

		if (g == "") {
			document.getElementById("show_IPAdrReserve").style.display = "none";
			document.getElementById("show_IPAdr").style.display = "table-row"
		} else {
			document.getElementById("show_IPAdrReserve").style.display = "table-row";
			document.getElementById("show_IPAdr").style.display = "none"
		}

		if (k != 0) {
			$("#client_Name").val(decodeSpecialChr(k));
		} else {
			$("#client_Name").val(decodeSpecialChr(a));
		}
		
		document.getElementById("client_IPAdrReserve").value = g;
		document.getElementById("client_MACAddress").innerHTML = h;
		$("#client_MACAddress").show();
		document.getElementById("client_IPAdr").innerHTML = c;
		if (n != 0) {
			document.getElementById("client_Vendor").innerHTML = n;
		} else {
			document.getElementById("client_Vendor").innerHTML = "N/A";
		}
		if (g != 0) {
			presetCheckBox("enableReserveIP", true);
			document.getElementById("TimmyCheckBox2").checked = true;
		} else {
			presetCheckBox("enableReserveIP", false);
			document.getElementById("TimmyCheckBox2").checked = false;
		}
	} else {
		document.getElementById("show_Vendor").style.display = "none";
		document.getElementById("show_IPAdrReserve").style.display = "none";
		document.getElementById("show_MACAddress").style.display = "table-row";
		document.getElementById("show_ReserveIP").style.display = "none";
		document.getElementById("show_IPAdr").style.display = "none";

		document.getElementById("IPAdrReserve_Info").innerHTML = "";

		if (k != 0) {
			$("#client_Name").val(decodeSpecialChr(k));
		} else {
			$("#client_Name").val(decodeSpecialChr(a));
		}
		
		document.getElementById("client_MACAddress").innerHTML = h;
		$("#client_MACAddress").show();
		if (g != 0) {
			presetCheckBox("enableReserveIP", true);
			document.getElementById("TimmyCheckBox2").checked = true;
		} else {
			presetCheckBox("enableReserveIP", false);
			document.getElementById("TimmyCheckBox2").checked = false;
		}
	}
	document.getElementById("editPop").style.display = "inline";
}

function closeEditPOP(h) {
	$("#MACAddress_Info").html("");
	$("#IPAdrReserve_Info").html("");

	if(document.getElementById("TimmyCheckBox2").checked) {
		var a = document.getElementById("client_IPAdrReserve").value;
		if (a != "") {
			if (!COMM_ValidV4Format(a) || !COMM_ValidV4Addr(a)) {
				document.getElementById("IPAdrReserve_Info").innerHTML = m_home_ip_error1;
				return;
			} else {
				var a_list = a.split(".");
				var dhcp_r_list = dhcp_range_start.split(".");

				for(var  i = 0; i < 4; i++) {
					if(i == 3) {
						if((parseInt(a_list[i]) < parseInt(dhcp_r_list[i])) || (parseInt(a_list[i]) > (parseInt(dhcp_r_list[i]) + parseInt(dhcp_pool_count)))) {
							document.getElementById("IPAdrReserve_Info").innerHTML = m_home_ip_error1;
							return;
						}
					} else {
						if(a_list[i] != dhcp_r_list[i]) {
							document.getElementById("IPAdrReserve_Info").innerHTML = m_home_ip_error1;
							return;
						}
					}
				}
				
				document.getElementById("IPAdrReserve_Info").innerHTML = "";
			}
		} else {
			document.getElementById("IPAdrReserve_Info").innerHTML = m_home_ip_error1;
			return;
		}

		if(!checkStaticInfo(a, $("#client_MACAddress").html(), $("#client_Name").val(), h, 1)) {
			return;
		}
	}

	ModifyDHCPTable(h);
}

function ModifyDHCPTable(static_loc) {
	var data = {};
	if (valueChanged == 1) {
		Get__client_Name = document.getElementById("client_Name").value;
		Get__MACAddress = document.getElementById("client_MACAddress").innerHTML;
		Get__ReserveIP = document.getElementById("client_IPAdrReserve").value;

		if(parseInt(static_loc) >= 0) {
			data.dhcpStaticLabel = static_loc;			
		} else {
			data.dhcpStaticLabel = staticClient_count;
		}

		if (!document.getElementById("TimmyCheckBox2").checked && Get__ReserveIP != "") {
			data.dhcpStaticType = "delete";
		}

		if(document.getElementById("TimmyCheckBox2").checked) {
			data.dhcpStaticIP = Get__ReserveIP;
			data.dhcpStaticMAC = Get__MACAddress;
			data.dhcpStaticHostname = Get__client_Name;
		}
		clearCreateRulePOP();
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("cliMessage").style.display = "inline";
		Start_reciprocal_Number_cli();
		setTimeout(function(){
			$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
				data.sessionKey = sessionKey;
				$.ajax({
					type: "POST",
					url: "/cgi-bin/New_GUI/Set/home_clientList.asp",
					data: jQuery.param(data),
					async: false,
					cache: false,
					dataType: "text",
					success: function(msg){
						document.getElementById("check_btn").setAttribute("class", "styled_button_dis");
						document.getElementById("check_btn").disabled = true;
						cliFlag = false;
						ClearAndRenew();
						Time_GetStatusXML = self.setInterval("GetStatusXML()",6000);
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						alert("Save Error!");
					}
				});			
			});
		},300);	
	} else {
		clearCreateRulePOP();
		ClearAndRenew();
	}	
}

function clearCreateRulePOP() {
	document.getElementById("editPop").style.display = "none";
	$("#schedule").selectbox("detach");
	document.getElementById("schedule").options[0].selected = true;
	$("#schedule").selectbox("attach");
}

function manuClearCreateRulePOP()
{
	document.getElementById("editPop").style.display = "none";
	$("#schedule").selectbox("detach");
	document.getElementById("schedule").options[0].selected = true;
	$("#schedule").selectbox("attach");
	cliFlag = false;
	Time_GetStatusXML = self.setInterval("GetStatusXML()",6000);
}

function ClearAndRenew() {
	if (GetFlagD == true && GetFlagE == false) {
		clearTimeout(Time_ClientList);
		Get_ClientInfo();
	} else {
		if (GetFlagD == false && GetFlagE == true) {
			clearTimeout(Time_ClientList);
			Get_ClientInfo();
		} else {
			if (GetFlagD == false && GetFlagE == false) {
				document.getElementById("client_btn_Guest").setAttribute("class", "v4v6_linkstyle_2");
				document.getElementById("client_btn_Host").setAttribute("class", "v4v6_linkstyle_1");
				clearTimeout(Time_ClientList);
			} else {
				document.getElementById("client_btn_Guest").setAttribute("class", "v4v6_linkstyle_2");
				document.getElementById("client_btn_Host").setAttribute("class", "v4v6_linkstyle_1");
				clearTimeout(Time_ClientList);
			}
		}
	}
}

function Set_Param(a) {
	if (a == "Host") {
		document.getElementById("client_btn_Guest").setAttribute("class", "v4v6_linkstyle_2");
		document.getElementById("client_btn_Host").setAttribute("class", "v4v6_linkstyle_1");
		GetFlagD = true;
		GetFlagE = false;
	} else {
		if (a == "Guest") {
			document.getElementById("client_btn_Guest").setAttribute("class", "v4v6_linkstyle_1");
			document.getElementById("client_btn_Host").setAttribute("class", "v4v6_linkstyle_2");
			GetFlagD = false;
			GetFlagE = true;
		}
	}
}

function Array2DVar(a, c) {
	this.length = a;
	this.x = a;
	this.y = c;
	for (var b = 0; b < this.length; b++) {
		this[b] = new Array(c);
	}
};

function checkMAC(m) {
	var allowChar = "01234567890ABCEDF";
	if (m == null)
		return false;

	if (m.length != 2)
		return false;

	m = m.toUpperCase();

	for (var i = 0; i < m.length; i++) {
		if (allowChar.indexOf(m.charAt(i)) == -1) return false;
	}

	if (m.length == 0) return false;
	return true;
}