function init(){
	if(AclValue.acl_active == "Yes")
		SetCheckBoxActivate("ActivateRDO", true, true);
	else
		SetCheckBoxActivate("ActivateRDO", true, false);

	if(AclValue.acl_rule_active == "Yes")
		SetCheckBoxActivate("RuleActiveRDO", true, true);
	else
		SetCheckBoxActivate("RuleActiveRDO", true, false);

	aclSwitch();
	hideSaveBtn();
}

function doAdd() {	
	$("label[class='error']").html("");
	if(parseInt(virtual_server_flag) == 1 && $("#RuleActiveRDO_ck").attr("checked")&& $("#InterfaceSEL").val()!="LAN")
		alert(m_acl_waring);

	if(!verifyForm())
		return;	

	$("#ACLActionFlag").val(0);

	if($("#ActivateRDO_ck").attr("checked"))
		$("#ActivateRDOValue").val("Yes");
	else
		$("#ActivateRDOValue").val("No");

	if($("#RuleActiveRDO_ck").attr("checked"))
		$("#RuleActiveRDOValue").val("Yes");
	else
		$("#RuleActiveRDOValue").val("No");

	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	Start_reciprocal_Number_RestoreConfiguration();

	$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){		
		$("#sessionKey").val(sessionKey);	
		setTimeout('$.post("/cgi-bin/New_GUI/Acl.asp", $("form").serialize(), function(){save_flag = true;});', 300);
	});	
}

function doIndexChange() {
	$("#ACLActionFlag").val(1);

	if($("#ActivateRDO_ck").attr("checked"))
		$("#ActivateRDOValue").val("Yes");
	else
		$("#ActivateRDOValue").val("No");

	if($("#RuleActiveRDO_ck").attr("checked"))
		$("#RuleActiveRDOValue").val("Yes");
	else
		$("#RuleActiveRDOValue").val("No");

	/*
	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	_ReciprocalNumber = 5;
	Start_reciprocal_Number_RestoreConfiguration();
	*/

	$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
		$("#sessionKey").val(sessionKey);	
		setTimeout('$.post("/cgi-bin/New_GUI/Acl.asp", $("form").serialize(), function(){self.location.href = self.location.href;});', 300);
	});
}

function doDel(){
	$("#ACLActionFlag").val(2);

	if($("#ActivateRDO_ck").attr("checked"))
		$("#ActivateRDOValue").val("Yes");
	else
		$("#ActivateRDOValue").val("No");

	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	Start_reciprocal_Number_RestoreConfiguration();

	$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){		
		$("#sessionKey").val(sessionKey);	
		setTimeout('$.post("/cgi-bin/New_GUI/Acl.asp", $("form").serialize(), function(){save_flag = true;});', 300);
	});
}             

function verifyForm(){
	var addrBegin = $("#ScrIPaddrBeginTXT").val();
	var addrEnd = $("#ScrIPaddrEndTXT").val();
	var hidden = $("#ACLActionFlag").val();

	/*var bActivate = false;	
	if($("#ActivateRDO_ck").attr("checked"))
		bActivate = true;
		*/	
	//if(hidden == 0 && bActivate)
	
	if($("#ActivateRDO_ck").attr("checked"))
	{
		if((addrBegin == "0.0.0.0")&&(addrEnd=="0.0.0.0")){
			return true;
		}
		else{
			if((!doValidateIP(addrBegin,0,1,0))||(!doValidateIP(addrEnd,0,1,0))){
				return false;
			}
			else{
				return doValidateRange(addrBegin, addrEnd);
			}
		}
	}	
	else{
		return true;
	}
}

function doValidateIP(Address, option1, option2, Where) {
	var address = Address.match("^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$");
	var digits;
	var i;

	if(((option1 == 1 || option1 == 4) && Address == "0.0.0.0") || (option1 == 2 && Address == "255.255.255.255"))
		return true;
		
	if(address == null)
	{
		if(option1 == 4 && Address == "")
			return true;
		if(Where == 1){
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error1+Address);
		}
		else if(Where == 2){
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error2);
		}
		else { 	  	         		       
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error3);
		}	    	        				         
		return false; 
	}
	
	digits = address[0].split(".");
	
	for(i=0; i < 4; i++)
	{
		if((Number(digits[i]) > 255 ) || (Number(digits[i]) < 0 ) || (option1 != 4 && Number(digits[0]) > 223))
		{ 
			if(Where == 1){
				$("#ScrIPaddr_error").html("<br/>"+m_acl_error1+Address);
			}
			else if(Where == 2){				
				$("#ScrIPaddr_error").html("<br/>"+m_acl_error2);
			}
			else{	  				
				$("#ScrIPaddr_error").html("<br/>"+m_acl_error4+ Address);
			}     	
			return false; 
		}
	}
	
	if((!isValidIpAddr(digits[0],digits[1],digits[2],digits[3])) || (option1 == 3 && Address == "1.0.0.0") || (option2 == 1 && digits[3] == 0))
	{
		if(Where == 1)
		{			
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error1+Address);
		}
		else if(Where == 2){			
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error2);

		}
		else{			
			$("#ScrIPaddr_error").html("<br/>"+m_acl_error4+ Address);
		}     	
		return false;
	}
	return true;
}

function doValidateRange(startIP, endIP) {
	var staddress;
	var edaddress;
	var cnt;	

	staddress=startIP.split(".");
	edaddress=endIP.split(".");
	
	for(cnt=0; cnt < 4; cnt++) {		
		if(parseInt(edaddress[cnt]) > parseInt(staddress[cnt])) {
			break;
		} 
		else {
			if(parseInt(edaddress[cnt]) == parseInt(staddress[cnt])) {
				continue;
			} 
			else {                     
				$("#ScrIPaddr_error").html("<br/>"+m_acl_error5);	            
				return false;
			}
		}
	}

	/*
	if(parseInt(staddress[cnt]) < 127 && parseInt(edaddress[cnt]) > 127) {
		$("#ScrIPaddr_error").html("<br/>Cannot contain 127 network subnet.");
		return false;
	}
	*/
	
	return true;
}

function isValidIpAddr(ip1,ip2,ip3,ip4) {
	if(ip1==0 || ip4==255 || ip1==127 || ip4==0)
		return false;

	return true;
}

function changeAcl(){	
	SetCheckBoxActivate("ActivateRDO");
	aclSwitch();
	hideSaveBtn();
}

function aclSwitch(){
	if($("#ActivateRDO_ck").attr("checked")) {
		$("#tAcl").show();
		hideSaveBtn();
	} 
	else {
		$("#tAcl").hide();
	}	
}

function changeAclRule(){
	SetCheckBoxActivate("RuleActiveRDO");
	hideSaveBtn();
}

var save_flag = false;
var _ReciprocalNumber = 10;
function Start_reciprocal_Number_RestoreConfiguration() {
	if (_ReciprocalNumber >= 0) {
		document.getElementById("reciprocal_Number").innerHTML = _ReciprocalNumber + m_comm_Sec;
		_ReciprocalNumber --;
		setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
	} else {
		if(save_flag) {
			document.getElementById("waitSettingFinish").style.display = "none";
			document.getElementById("SuccessSettings").style.display = "inline";
		} else {
			setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
		}
	}
}

