#!/bin/sh
echo -e "Content-Type: text/html\n\n"
tcapi_path=/userfs/bin/
virtual_server_flag=0
for i in 0 1 2 3 4 5 6 7
do 
	for j in 0 1 2 3 4 5 6 7 8 9
	do
		node_name="VirServer_PVC"$i"_Entry"$j""
		virtual_LOCALIP=`"$tcapi_path"tcapi get $node_name LOCALIP`
		virtual_LOCALIP=`"$tcapi_path"alpha_tcapi $virtual_LOCALIP`
		if [ "$virtual_LOCALIP" = "no node information" -o "$virtual_LOCALIP" = "0.0.0.0" -o "$virtual_LOCALIP" = "no attribute information" -o "$virtual_LOCALIP" = "connection error" ]; then
			continue
		else			
			virtual_LOCAL_SPORT=`"$tcapi_path"tcapi get $node_name LOCAL_SPORT`
			virtual_LOCAL_SPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_SPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"tcapi get $node_name LOCAL_EPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_EPORT`
			virtual_STARTPORT=`"$tcapi_path"tcapi get $node_name STARTPORT`
			virtual_STARTPORT=`"$tcapi_path"alpha_tcapi $virtual_STARTPORT`
			virtual_ENDPORT=`"$tcapi_path"tcapi get $node_name ENDPORT`
			virtual_ENDPORT=`"$tcapi_path"alpha_tcapi $virtual_ENDPORT`

			if [ $virtual_LOCAL_SPORT -le 80 ] && [ $virtual_LOCAL_EPORT -ge 80 ]; then
				virtual_server_flag=1
			fi

			if [ $virtual_STARTPORT -le 80 ] && [ $virtual_ENDPORT -ge 80 ]; then
				virtual_server_flag=1
			fi
		fi
	done
done

nat_pvc_ext=`"$tcapi_path"tcapi get WebCurSet_Entry nat_pvc_ext`
nat_pvc_ext=`"$tcapi_path"alpha_tcapi $nat_pvc_ext`
wan_pvc_ext=`"$tcapi_path"tcapi get WebCurSet_Entry wan_pvc_ext`
wan_pvc_ext=`"$tcapi_path"alpha_tcapi $wan_pvc_ext`

for i in 0 1 2 3 4 5 6 7
do 
	`"$tcapi_path"tcapi set WebCurSet_Entry nat_pvc_ext $i`
	for j in 0 1 2 3 4 5 6 7 8 9
	do
		node_name="VirServer_PVC8_Entry"$j""
		virtual_LOCALIP=`"$tcapi_path"tcapi get $node_name LOCALIP`
		virtual_LOCALIP=`"$tcapi_path"alpha_tcapi $virtual_LOCALIP`
		if [ "$virtual_LOCALIP" = "no node information" -o "$virtual_LOCALIP" = "0.0.0.0" -o "$virtual_LOCALIP" = "no attribute information" -o "$virtual_LOCALIP" = "connection error" ]; then
			continue
		else	
			virtual_LOCAL_SPORT=`"$tcapi_path"tcapi get $node_name LOCAL_SPORT`
			virtual_LOCAL_SPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_SPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"tcapi get $node_name LOCAL_EPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_EPORT`
			virtual_STARTPORT=`"$tcapi_path"tcapi get $node_name STARTPORT`
			virtual_STARTPORT=`"$tcapi_path"alpha_tcapi $virtual_STARTPORT`
			virtual_ENDPORT=`"$tcapi_path"tcapi get $node_name ENDPORT`
			virtual_ENDPORT=`"$tcapi_path"alpha_tcapi $virtual_ENDPORT`

			if [ $virtual_LOCAL_SPORT -le 80 ] && [ $virtual_LOCAL_EPORT -ge 80 ]; then
				virtual_server_flag=1
			fi

			if [ $virtual_STARTPORT -le 80 ] && [ $virtual_ENDPORT -ge 80 ]; then
				virtual_server_flag=1
			fi
		fi
	done
done

for i in 0 1 2 3 4 5 6 7
do 
	`"$tcapi_path"tcapi set WebCurSet_Entry nat_pvc_ext $i`
	for j in 0 1 2 3 4 5 6 7 8 9
	do
		node_name="VirServer_PVC10_Entry"$j""
		virtual_LOCALIP=`"$tcapi_path"tcapi get $node_name LOCALIP`
		virtual_LOCALIP=`"$tcapi_path"alpha_tcapi $virtual_LOCALIP`
		if [ "$virtual_LOCALIP" = "no node information" -o "$virtual_LOCALIP" = "0.0.0.0" -o "$virtual_LOCALIP" = "no attribute information" -o "$virtual_LOCALIP" = "connection error" ]; then
			continue
		else	
			virtual_LOCAL_SPORT=`"$tcapi_path"tcapi get $node_name LOCAL_SPORT`
			virtual_LOCAL_SPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_SPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"tcapi get $node_name LOCAL_EPORT`
			virtual_LOCAL_EPORT=`"$tcapi_path"alpha_tcapi $virtual_LOCAL_EPORT`
			virtual_STARTPORT=`"$tcapi_path"tcapi get $node_name STARTPORT`
			virtual_STARTPORT=`"$tcapi_path"alpha_tcapi $virtual_STARTPORT`
			virtual_ENDPORT=`"$tcapi_path"tcapi get $node_name ENDPORT`
			virtual_ENDPORT=`"$tcapi_path"alpha_tcapi $virtual_ENDPORT`

			if [ $virtual_LOCAL_SPORT -le 80 ] && [ $virtual_LOCAL_EPORT -ge 80 ]; then
				virtual_server_flag=1
			fi

			if [ $virtual_STARTPORT -le 80 ] && [ $virtual_ENDPORT -ge 80 ]; then
				virtual_server_flag=1
			fi
		fi
	done
done

`"$tcapi_path"tcapi set WebCurSet_Entry nat_pvc_ext $nat_pvc_ext`
`"$tcapi_path"tcapi set WebCurSet_Entry wan_pvc_ext $wan_pvc_ext`

echo "var virtual_server_flag = '$virtual_server_flag';"