<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel=stylesheet type="text/css" href="/layout/New_GUI/jquery.selectbox.css" />
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJS.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialCSS.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJQ.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialValidate.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/ajaxfileupload.js"></script>
<!--<script src="/LanguageFamily/en/msg_multipe.js" type="text/javascript"></script>-->

<script>

	var lan_ip = "<%TCWebApi_get("Lan_Entry0","IP","s")%>"
	
	$(document).ready(function(){
		$(".trigger-file-input").click(function() {
			$("#tools_FW_UploadFile").click();
		});
	});
	
	var Time_GetReciprocalTime;
	var _ReciprocalRebootNumber = 0;
	var _ReciprocalFactoryDefaultNumber = 0;
	var _ReciprocalNumber = 0;
	function returnToMain() {
		document.getElementById("CreatePopAlertMessage").style.display = "none";
		document.getElementById("RCFCheck").style.display = "none";
		document.getElementById("FailedRCF").style.display = "none";
		document.getElementById("SuccessRCF").style.display = "none";
		document.getElementById("REBOOTCheck").style.display = "none";
		document.getElementById("REBOOT").style.display = "none";
		document.getElementById("SuccessREBOOT").style.display = "none";
		document.getElementById("FACTORYDEFAULTCheck").style.display = "none";
		document.getElementById("FACTORYDEFAULT").style.display = "none";
		document.getElementById("SuccessFACTORYDEFAULT").style.display = "none";
	}

	function returnToMain2()	{	self.location.href="System.asp";	}

	function returnToHome()	{	self.location.href = "/";	}

	function Device_Reboot_btn() {
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("REBOOTCheck").style.display = "block";
	}

	function Device_Reboot() {
		var data = {};
		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			data.sessionKey = sessionKey;
			data.reboot_type = 1;
			$.post("/cgi-bin/New_GUI/Set/reboot_wait.asp", data, function(){
				document.getElementById("REBOOTCheck").style.display = "none";
				document.getElementById("REBOOT").style.display = "block";
				_ReciprocalRebootNumber = 90;
				Time_GetReciprocalTime = window.clearInterval(Time_GetReciprocalTime);
				Start_reciprocal_Number_Reboot();
			});
		});	
	}

	function Start_reciprocal_Number_Reboot() {
		if (_ReciprocalRebootNumber >= 0) {
			document.getElementById("reciprocal_Number_Reboot").innerHTML = "";
			document.getElementById("reciprocal_Number_Reboot").innerHTML = _ReciprocalRebootNumber + " " + I18N("j", m_comm_Sec);
			_ReciprocalRebootNumber --;
			setTimeout("Start_reciprocal_Number_Reboot()", 1000);
		} else {
			document.getElementById("REBOOT").style.display = "none";
			document.getElementById("SuccessREBOOT").style.display = "block";
		}
	}

	function SetFactory_Default() {
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("FACTORYDEFAULTCheck").style.display = "block";
	}

	function Device_FDReboot() {
		var data = {};
		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			data.sessionKey = sessionKey;
			data.reboot_type = 2;
			$.post("/cgi-bin/New_GUI/Set/reboot_wait.asp", data, function(){
				document.getElementById("FACTORYDEFAULTCheck").style.display = "none";
				document.getElementById("FACTORYDEFAULT").style.display = "block";

				_ReciprocalFactoryDefaultNumber = 90;
				Time_GetReciprocalTime = window.clearInterval(Time_GetReciprocalTime);
				Start_reciprocal_Number_FactoryDefault();
			});
		});	
	}

	function Start_reciprocal_Number_FactoryDefault() {
		if (_ReciprocalFactoryDefaultNumber >= 0) {
			document.getElementById("reciprocal_Number_FactoryDefault").innerHTML = "";
			document.getElementById("reciprocal_Number_FactoryDefault").innerHTML = _ReciprocalFactoryDefaultNumber + " " + I18N("j", m_comm_Sec);
			_ReciprocalFactoryDefaultNumber --;
			setTimeout("Start_reciprocal_Number_FactoryDefault()", 1000);
		} else {
			document.getElementById("FACTORYDEFAULT").style.display = "none";
			document.getElementById("SuccessFACTORYDEFAULT").style.display = "block";
		}
	}	

	function Save_Cfg() {	
		top.location.href = "/romfile.cfg";
	}

	function ShowUploadButton(id, obj) {
		document.getElementById(id).value = obj.value.substr(obj.value.lastIndexOf('\\') + 1);
		document.getElementById(id + "_Button").style.display = "";
	}

	function RCF_Check_btn() {
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("RCFCheck").style.display = "block";
	}

	function Device_RFC() {
		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			var data = {};
			data.postflag = 1;
			data.UG_filetype = "romfile";
			data.HTML_HEADER_TYPE = 2;
			data.upgrade_fw = 2;
			data.sessionKey = sessionKey;

			$.ajaxFileUpload({	url:"/cgi-bin/New_GUI/Set/config_upgrade.asp", 
				secureuri:false,
				fileElementId:"tools_FW_UploadFile",
				dataType: "text",	
				data: data,
				success: function (resp){
					if(resp.indexOf("SUCCESS") != -1) {
						document.getElementById("CreatePopAlertMessage").style.display = "inline";
						document.getElementById("RCFCheck").style.display = "none";
						document.getElementById("RCF").style.display = "block";
						_ReciprocalNumber = 100;
						Start_reciprocal_Number_RestoreConfiguration();
					} else {
						document.getElementById("CreatePopAlertMessage").style.display = "inline";
						document.getElementById("RCFCheck").style.display = "none";
						document.getElementById("FailedRCF").style.display = "block";
					}
				}
			});
		});	
	}

	function Start_reciprocal_Number_RestoreConfiguration() {
		if (_ReciprocalNumber >= 0) {
			document.getElementById("reciprocal_Number").innerHTML = "";
			document.getElementById("reciprocal_Number").innerHTML = _ReciprocalNumber + " " + I18N("j", m_comm_Sec);
			_ReciprocalNumber --;
			setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
		} else {
			document.getElementById("RCF").style.display = "none";
			document.getElementById("SuccessRCF").style.display = "block";
		}
	}
</script>

<script type="text/javascript">
	function Load_HTML()	{	$("#header").load("header.asp");	}
	function Initial() {
		initialMenu();
	}
	function GetXML()	{ document.getElementById("main").style.display = "inline";	}
</script>

<style>
.block th{width:300px;font-weight:normal;text-align:right}
</style>
</head>

<body>
	<div id="wrapper">
		<!-------------------- Logo ------------------------->
		<div id="header"></div>
		<!-------------------- Menu ------------------------->
		<div id="menu"></div>
		<div id="menu_edge"></div>
		<!-------------------- Content ---------------------->
		<div id="content">
			<!-------------------- info ---------------------->
	  		<div id="info">
			  	<div id="FunctionName"><script>I18N("h", m_systme_header);</script></div>
			  	<div id="wall"><img id="page_Admin" src="/graphic/New_GUI/page_System.png" alt="" width="195" height="119"/></div>
			    <div id="directions">
					<script>I18N("h", m_systme_desc);</script>
				</div>
			</div>
		    <!-------------------- funcBar ---------------------->
		    <div id="funcBar">
				<div id="pagePath"><script>I18N("h", m_comm_Managment);</script> >> <script>I18N("h", m_systme_header);</script></div>
				<ul id="rightFunc">
					<li style="display:none"><div id="Save_btn" style="cursor:pointer; display:none"><script>I18N("h", m_comm_Save);</script></div></li>
					<li style="display:none"><div id="Save_Disable_btn"><script>I18N("h", m_comm_Save);</script></div></li>
					<li style="display:block"><a href="javascript:CheckHTMLStatus('Admin');" style="text-decoration:none;"><div id="page_btn" class="linkstyle_1"><script>I18N("h", m_comm_Admin);</script></div></a></li>
				</ul>
			</div>
	    	<!-------------------- main ------------------------->
	     	<div id="main" style="display:none">
 		   		<!-------------------- general ---------------------->
 		   		<div>
					<table class="block" border="0" style="margin: 10px 0 0 0 ;">
						 <tr>
							<td colspan="2"><div class ="title"><script>I18N("h", m_systme_deviceinfo);</script></div></td
						 </tr>
						 
						<tr>
							<th><script>I18N("h", m_systme_HV);</script>:</th>
							<td>
								<div class="file-box">
								<%If tcWebApi_get("SysInfo_Entry","HWVer","h") <> "N/A" then tcWebApi_get("SysInfo_Entry","HWVer","s") end if%>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", m_systme_FW);</script>:</th>
							<td>
								<div class="file-box">
								<script>I18N("h", "<%TCWebApi_get("DeviceInfo","FwVer","s")%>");</script>
								</div>
							</td>
						</tr>
					</table>
				</div>
				<hr />
 		   		
				<table class="block" border="0" style="margin: 10px 0 0 0 ;">
					<tbody>
						 <tr>
							<td colspan="2"><div class ="title"><script>I18N("h", m_systme_setting);</script></div></td
						 </tr>
						<tr>
							<th><script>I18N("h", m_systme_savereboot);</script>:</th>
							<td>
								<div class="file-box">
									<button type="button" class="styled_button_s" style="min-width:200px;" onclick="Device_Reboot_btn()" ><script>I18N("h", m_systme_reboot);</script></button>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", m_systme_restoretoft);</script>:</th>
							<td>
								<div class="file-box">
									<button type="button" class="styled_button_s" style="min-width:200px;" onclick="SetFactory_Default()" ><script>I18N("h", m_systme_restore);</script></button>
								</div>
							</td>
						</tr>

						<tr>
							<th><script>I18N("h", m_systme_savesettings);</script>:</th>
							<td>
								<div class="file-box">
									<button type="button" class="styled_button_s" style="min-width:200px;" onclick="Save_Cfg()" ><script>I18N("h", m_comm_Save);</script></button>
								</div>
							</td>
						</tr>

						<form ENCTYPE="multipart/form-data" method="POST" name="uiPostUpdateForm" id="uiPostUpdateForm" action="config_upgrade.asp">
							<tr id="First_LSFLHD">
							   	<th><script>I18N("h", m_systme_loadsettings);</script>:</th>
							   	<td>
							   		<div class="file-box">
							   			<label for="select_Folder" id="browse_Button" class="trigger-file-input" style="min-width:168px; left:0px"><script>I18N("h", m_systme_selfile);</script></label>
							   			<input type="file" name="tools_FW_UploadFile" id="tools_FW_UploadFile" style="display:none" onchange="ShowUploadButton('upload_File',this);" />
							   		</div>
							   	</td>
							   	<td>
							   		<input type="text" name="upload_File" id="upload_File" size="40" style="border:0px;height:40px;color:#4598AA;box-shadow:0 0 0" readonly>
							   	</td>
							</tr>
							<tr id="upload_File_Button" style="display:none">
								<th></th>
								<td>
									<button type="button" class="styled_button_s" id="styled_button_s" style="min-width:200px;" onclick="RCF_Check_btn()"><script>I18N("h", m_systme_uploadsetting);</script></button>
									<input type="button" value="Upload Settings" id="upload_button" style="display: none" onclick="RCF_Check_btn()">
								</td>
							</tr>
						</form>
					</tbody>
			    </table>
		 	</div>
			<div id="CreatePopAlertMessage" style="display:none;">
				<div id="AlertPopRect">
					<div id="AlertPopBody">
						<!---------- Restore Configuration File Check ---------->
						<div id="RCFCheck" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_desc1);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<div class="popMessage_button" onclick="Device_RFC()"><script>I18N("h", m_comm_ok);</script></div>
									 </td>
									 <td>
									 	<div class="popMessage_button" onclick="returnToMain()"><script>I18N("h", m_comm_Cancel);</script></div>
									 </td>
								 </tr>
							</table>
						</div>

						<!---------- Restore Configuration File ---------->
						<div id="RCF" class="popMessage" style="display:none;">
							<div class="popMessage_icon_loading"></div>
							<label id="reciprocal_Number" class="popMessage_timer"></label>
							<table class="popMessage_infor_red">
								<tr>
									<td>
										<script>I18N("h", m_systme_desc2);</script>
									</td>
								<tr>
							</table>
						</div>
						<!---------- Failed - Restore Configuration File ---------->
						<div id="FailedRCF" class="popMessage" style="display:none;">
							<div class="popMessage_icon_warning"></div>
							<table class="popMessage_infor_red" border="0">
								<tr>
									<td>
										<script>I18N("h", m_systme_restorefaied);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<center><div class="popMessage_button" onclick="returnToMain2()"><script>I18N("h", m_comm_ok);</script></div>
									 	</center>
									 </td>
								 </tr>
							</table>
						</div>
						<!---------- Success - Restore Configuration File ---------->
						<div id="SuccessRCF" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_restoreok);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<center><div class="popMessage_button" onclick="returnToHome()"><script>I18N("h", m_comm_ok);</script></div></center>
									 </td>
								 </tr>
							</table>
						</div>

						<!---------- Confirm Reboot ---------->
						<div id="REBOOTCheck" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_desc3);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<div class="popMessage_button" onclick="Device_Reboot()"><script>I18N("h", m_comm_ok);</script></div>
									 </td>
									 <td>
									 	<div class="popMessage_button" onclick="returnToMain()"><script>I18N("h", m_comm_Cancel);</script></div>
									 </td>
								 </tr>
							</table>
						</div>
						<!---------- Reboot ------------>
						<div id="REBOOT" class="popMessage" style="display:none;">
							<div class="popMessage_icon_loading"></div>
							<label id="reciprocal_Number_Reboot" class="popMessage_timer"></label>
							<table class="popMessage_infor_short">
								<tr>
									<td>
										<script>I18N("h", m_systme_rebooting);</script>
									</td>
								<tr>
							</table>
						</div>
						<!---------- Success - Reboot ---------->
						<div id="SuccessREBOOT" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_rebootok);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<center><div class="popMessage_button" onclick="returnToHome()"><script>I18N("h", m_comm_ok);</script></div></center>
									 </td>

								 </tr>
							</table>
						</div>

						<!---------- Confirm Factory Default ---------->
						<div id="FACTORYDEFAULTCheck" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_desc4);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<div id="Confirm_btn" class="popMessage_button" onclick="Device_FDReboot()"><script>I18N("h", m_comm_ok);</script></div>
									 </td>
									 <td>
									 	<div id="Confirm_btn" class="popMessage_button" onclick="returnToMain()"><script>I18N("h", m_comm_Cancel);</script></div>
									 </td>
								 </tr>
							</table>
						</div>
						<!---------- Factory Default ---------->
						<div id="FACTORYDEFAULT" class="popMessage" style="display:none;">
							<div class="popMessage_icon_loading"></div>
							<label id="reciprocal_Number_FactoryDefault" class="popMessage_timer"></label>
							<table class="popMessage_infor_short">
								<tr>
									<td>
										<script>I18N("h", m_systme_rebooting);</script>
									</td>
								<tr>
							</table>
						</div>

						<!---------- Success - Factory ---------->
						<div id="SuccessFACTORYDEFAULT" class="popMessage" style="display:none;">
							<div class="popMessage_icon"></div>
							<table class="popMessage_infor">
								<tr>
									<td>
										<script>I18N("h", m_systme_desc5);</script>
									</td>
								<tr>
							</table>
							<table class="popMessage_button_table">
								 <tr>
									 <td>
									 	<center><div class="popMessage_button" onclick="returnToHome()"><script>I18N("h", m_comm_ok);</script></div></center>
									 </td>

								 </tr>
							</table>
						</div>

					</div>
				</div>
			</div>	
		 <div id="DetectRouterConnection" style="display:none"></div>
		 <div id="footer" border="0">
			<div id="copyright"><script>prints(m_comm_copyright);</script></div>
			<div id="help">
				<a target="_blank" href="http://www.dlink.com/support" style="cursor:pointer;text-Decoration:underline">
					
						<script>prints(m_home_gethelp);</script>
					
				</a>
			</div>
		</div>
	</div>
<script type="text/javascript" charset="utf-8">
	// Detect Browser
	function DetectBrowserVersion()
	{
		var nVer = navigator.appVersion;
		var navigatorAgent = navigator.userAgent;
		var browserName  = navigator.appName;
		var fullVersion  = ''+parseFloat(navigator.appVersion);
		var majorVersion = parseInt(navigator.appVersion,10);
		var nameShift,versionShift,trimSemicolon;

		if ((versionShift = navigatorAgent.indexOf("Opera")) != -1) {
			browserName = "Opera";
			fullVersion = navigatorAgent.substring(versionShift + 6);
			if ((versionShift = navigatorAgent.indexOf("Version")) != -1)
			fullVersion = navigatorAgent.substring(versionShift + 8);
		}
		else if ((versionShift = navigatorAgent.indexOf("MSIE")) != -1) {
			browserName = "Microsoft Internet Explorer";
			fullVersion = navigatorAgent.substring(versionShift + 5);
		}
		else if ((versionShift = navigatorAgent.indexOf("Sleipnir")) != -1) {
			browserName = "Sleipnir";
			fullVersion = navigatorAgent.substring(versionShift + 9);
		}
		else if ((versionShift = navigatorAgent.indexOf("Chrome")) != -1) {
			browserName = "Chrome";
			fullVersion = navigatorAgent.substring(versionShift + 7);
		}
		else if ((versionShift = navigatorAgent.indexOf("Safari")) != -1) {
			browserName = "Safari";
			fullVersion = navigatorAgent.substring(versionShift + 7);
			if ((versionShift = navigatorAgent.indexOf("Version")) != -1)
			fullVersion = navigatorAgent.substring(versionShift + 8);
		}
		else if ((versionShift = navigatorAgent.indexOf("Firefox")) != -1) {
			browserName = "Firefox";
			fullVersion = navigatorAgent.substring(versionShift + 8);
		}
		else if ((nameShift = navigatorAgent.lastIndexOf(' ') + 1) <
			(versionShift = navigatorAgent.lastIndexOf('/'))) {
			browserName = navigatorAgent.substring(nameShift, versionShift);
			fullVersion = navigatorAgent.substring(versionShift + 1);
			if (browserName.toLowerCase() == browserName.toUpperCase()) {
				browserName = navigator.appName;
			}
		}

		if ((trimSemicolon = fullVersion.indexOf(";")) != -1)
			fullVersion = fullVersion.substring(0, trimSemicolon);
		if ((trimSemicolon = fullVersion.indexOf(" ")) != -1)
			fullVersion = fullVersion.substring(0, trimSemicolon);
			majorVersion = parseInt('' + fullVersion, 10);
		if (isNaN(majorVersion)) {
			fullVersion = '' + parseFloat(navigator.appVersion);
			majorVersion = parseInt(navigator.appVersion, 10);
		}
		
		if (browserName == "Microsoft Internet Explorer")
		{
			// Not Support
			$("#browse_Button").hide();
			$("#tools_FW_UploadFile").show();
			$("#upload_File").hide();
			$("#styled_button_s").hide();
			$("#upload_button").show();
		}
		
		if (browserName == "Safari")
		{
			// Not Support
			$("#browse_Button").hide();
			$("#tools_FW_UploadFile").show();
			$("#upload_File").hide();
			$("#styled_button_s").hide();
			$("#upload_button").show();
		}
		
		if (browserName == "Opera")
		{
			if (majorVersion < 13)
			{
				// Not Support
				$("#browse_Button").hide();
				$("#tools_FW_UploadFile").show();
				$("#upload_File").hide();
				$("#styled_button_s").hide();
				$("#upload_button").show();
			}
		}
	}
	
	DetectBrowserVersion();
	
	var _ReciprocalNumber = 0;
	if($("#browse_Button").is(":visible")) {
		$('.trigger-file-input').click(function() {
			$('#tools_FW_UploadFile').click();
	    });
	}
</script>
</body>
<script type="text/javascript">
	Load_HTML();
	Initial();
	setMenu("menu_Management");
	GetXML();
</script>
</html>
