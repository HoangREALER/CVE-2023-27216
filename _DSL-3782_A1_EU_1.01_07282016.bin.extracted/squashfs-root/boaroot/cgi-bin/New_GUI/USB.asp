<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel=stylesheet type="text/css" href="/layout/New_GUI/jquery.selectbox.css?v=20140910163551" />
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialCSS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJQ.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialValidate.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/configuration/DeviceConfig.js?v=TimeStamp_QzwsxDcRfvTGByHn"></script>
<!--<script src="/LanguageFamily/en/msg_multipe.js" type="text/javascript"></script>-->

<script type="text/javascript">
	var usb_val = {
		"dlna_enable": "<%TCWebApi_get("DLNA_Entry","Enable","s")%>",
		"samba_active": "<%TCWebApi_get("Samba_Entry","Active","s")%>",
		"samba_wg": "<%TCWebApi_get("Samba_Entry","WorkGroup","s")%>",
		"samba_nbn": "<%TCWebApi_get("Samba_Entry","NetBiosName","s")%>"
	};

	function Load_HTML() {
		$("#header").load("header.asp");
	}
	
	function Initial() {
		initialMenu();
	}
	function decodeSpecialChr(str)
	{
		str=str.replace(/&amp;/g,"&");
		str=str.replace(/&lt;/g,"<");
		str=str.replace(/&gt;/g,">");
		str=str.replace(/&quot;/g,"\"");
		str=str.replace(/&#39;/g,"'");
		str=str.replace(/&#59;/g,";");
		str=str.replace(/&#61;/g,"=");
		str=str.replace(/&#43;/g,"+");
		str=str.replace(/&#45;/g,"-");
		
		return str;
	}
	function InitUSB() {
		SetCheckBoxEnable("dlna_status", true, (usb_val.dlna_enable == "Yes"?true:false));

		SetCheckBoxEnable("samba_status", true, (usb_val.samba_active == "Yes"?true:false));
		$("#samba_work_group").val(decodeSpecialChr(usb_val.samba_wg));
		$("#samba_nbn").val(decodeSpecialChr(usb_val.samba_nbn));

		if($("#samba_status_ck").attr("checked")) {
			$("#samba_nbn").removeAttr("disabled");
			$("#samba_work_group").removeAttr("disabled");
		} else {
			$("#samba_nbn").attr("disabled", "disabled");
			$("#samba_work_group").attr("disabled", "disabled");				
		}
		
		$("#main").show();
	}

	function isUnsafeChar(cmpStr)
	{
		var regStr=/[a-zA-Z0-9]/;
	  	for(i=0;i<cmpStr.length;i++)
	  	{ 
	  		if(cmpStr.charAt(i) == ' ')
				continue;
			if (cmpStr.charAt(i).search(regStr)==-1) //contain the unsafe char
				return false;
		}
		return true;	
	}

	function doSave() {
		$("label[class='error']").html("");
		usb_val.dlna_enable  = ($("#dlna_status_ck").attr("checked")?"Yes":"No");
		usb_val.samba_active = ($("#samba_status_ck").attr("checked")?"Yes":"No");

		if(usb_val.samba_active == "Yes") {
			/*
			if(isValidNameEx($("#samba_work_group").val()) == false ){
				$("#samba_work_group_error").html("<br/>"+m_usb_error_1);
				return false;
			}
			*/
			if(($("#samba_work_group").val().length == 0)||($("#samba_work_group").val().length > 15)) {
				$("#samba_work_group_error").html("<br/>"+m_usb_error_2);
				return false;
			}
			if(!isUnsafeChar($("#samba_work_group").val())) {
				$("#samba_work_group_error").html("<br/>"+m_usb_error_3);
				return false;
			}
			
			/*
			if(isValidNameEx($("#samba_nbn").val()) == false ){
				$("#samba_nbn_error").html("<br/>"+m_usb_error_4);
				return false;
			}				
			if(($("#samba_nbn").val().length == 0)||($("#samba_nbn").val().length > 15)||(!Prefixes_Rule_cgi_num($("#samba_nbn").val()))) {
				$("#samba_nbn_error").html("<br/>"+m_usb_error_5);
				return false;
			}
			*/
			if($("#samba_nbn").val().length == 0||$("#samba_nbn").val().length > 15) {
				$("#samba_nbn_error").html("<br/>"+m_usb_error_6);
				return false;
			}
			if(!isUnsafeChar($("#samba_nbn").val())) {
				$("#samba_nbn_error").html("<br/>"+m_usb_error_7);
				return false;
			}

			usb_val.samba_wg  = $("#samba_work_group").val();
			usb_val.samba_nbn = $("#samba_nbn").val();
		}
	
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("waitSettingFinish").style.display = "inline";
		Start_reciprocal_Number_RestoreConfiguration();

		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			usb_val.sessionKey = sessionKey;
			setTimeout('$.post("/cgi-bin/New_GUI/Set/USB.asp", usb_val, function(){save_flag = true;});', 300);
		});
	}

	var save_flag = false;
	var _ReciprocalNumber = 10;
	function Start_reciprocal_Number_RestoreConfiguration() {
		if (_ReciprocalNumber >= 0) {
			document.getElementById("reciprocal_Number").innerHTML = _ReciprocalNumber + " " + I18N("j", m_comm_Sec);
			_ReciprocalNumber --;
			setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
		} else {
			if(save_flag) {
				document.getElementById("waitSettingFinish").style.display = "none";
				document.getElementById("SuccessSettings").style.display = "inline";
			} else {
				setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
			}
		}
	}

	function isValidNameEx(name) {
		var i = 0;	
		
		for( i = 0; i < name.length; i++ ) {			
			if ( isNameUnsafeEx(name.charAt(i)) == true )
				return false;
		}

		return true;
	}

	function isNameUnsafeEx(compareChar) {			
		if( compareChar.charCodeAt(0) > 31 && compareChar.charCodeAt(0) < 127){
			return false; // found no unsafe chars, return false
		}
		else
			return true;
	}	

	function Prefixes_Rule_cgi_num(TelNum){
		for (var i=0; i<TelNum.length; i++) {  
			if(TelNum.charCodeAt(i)<48 || TelNum.charCodeAt(i)>122){ 
				if(TelNum.charCodeAt(i) != 32)
					return false;
			}
			else {
				if(TelNum.charCodeAt(i)>57 && TelNum.charCodeAt(i)<65) 
					return false;
				if(TelNum.charCodeAt(i)>90 &&TelNum.charCodeAt(i)<97)
					return false;
			}
	 	}
		return true;
	}
</script>
<script language="JavaScript">
	$(function() {
		$("button").click(function () { save_button_changed(); });
		$("input, textarea, select").change(function () { save_button_changed(); });
		$("input, textarea").keypress(function () { save_button_changed(); });

		$(".checkbox_on, .checkbox_off").click(function() {	SetCheckBoxEnable($(this).attr("id"));	});

		$("input[type='text']").each(function() {	$(this).parent().append("<label id='"+$(this).attr("id")+"_error' name='"+$(this).attr("id")+"_error' class='error'></label>");	});

		$("#samba_status").click(function() {
			if($("#samba_status_ck").attr("checked")) {
				$("#samba_nbn").removeAttr("disabled");
				$("#samba_work_group").removeAttr("disabled");
			} else {
				$("#samba_nbn").attr("disabled", "disabled");
				$("#samba_work_group").attr("disabled", "disabled");				
			}
		});

		Load_HTML();
		Initial();
		setMenu("menu_Settings");
		InitUSB();
	});
</script>
</head>

<body>
	<form method="POST" action="">
		<div id="wrapper">
			<!-------------------- Logo ------------------------->
			<div id="header"></div>
			<!-------------------- Menu ------------------------->
			<div id="menu"></div>
			<!-------------------- Content ---------------------->
			<div id="content">
				<!-------------------- info ------------------------->
				<div id="info">
					<div id="FunctionName"><script>I18N("h", m_comm_USB);</script></div>
					<div id="wallimage"><img src="/graphic/New_GUI/wall.png" alt="" width="195" height="119"/></div>
					<div id="directions">
						<script>I18N("h", m_usb_desc);</script>
					</div>
				</div>
				<!-------------------- funcBar ---------------------->
				<div id="funcBar">
					<div id="pagePath">&nbsp;<script>I18N("h", m_comm_settings);</script> >> <script>I18N("h", m_comm_USB);</script></div>
					<ul id="rightFunc">
						<li style="display:block"><div id="Save_btn" onclick="document.getElementById('sumbit_CheckData').click()" style="cursor:pointer; display:none"><script>I18N("h", m_comm_Save);</script></div></li>
						<li style="display:block"><div id="Save_Disable_btn"><script>I18N("h", m_comm_Save);</script></div></li>
						<input id="sumbit_CheckData" class="submit" type="button" value="button" style="display:none" onClick="doSave();"/>
					</ul>
				</div>
	     	<!-------------------- main ---------------------->
	     	<div id="main" style="display:none">
				<!-------------------- USB Settings ---------------------->
				<div>
					<table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
						<tr>
							<td><div class ="title"><script>I18N("h", m_usb_dlnasetting);</script></div></td>
							<td></td>
						</tr>

						<tr>
							<th><script>I18N("h", m_usb_DLNA);</script>:</th>
							<td>
								<div id="dlna_status" class="checkbox_on">
									<input type="checkbox" id="dlna_status_ck" name="dlna_status_ck">
								</div>
							</td>
						</tr>
					</table>
				</div>
				<hr />

				<div>
					<table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
						<tr>
							<td><div class ="title"><script>I18N("h", m_usb_sambasetup);</script></div></td>
							<td></td>
						</tr>

						<tr>
							<th><script>I18N("h", m_usb_samba);</script>:</th>
							<td>
								<div id="samba_status" class="checkbox_on">
									<input type="checkbox" id="samba_status_ck" name="samba_status_ck">
								</div>
							</td>
						</tr>

						<tr>
							<th><script>I18N("h", m_usb_workgroup);</script>:</th>
							<td><input class="styled-text" type="text" name="samba_work_group" maxlength="32" size="30" id="samba_work_group"></td>
						</tr>

						<tr>
							<th><script>I18N("h", m_usb_error_netbios);</script>:</th>
							<td><input class="styled-text" type="text" name="samba_nbn" maxlength="32" size="30" id="samba_nbn"></td>
						</tr>
					</table>
				</div>

				<div id="CreatePopAlertMessage" style="display:none">
					<div id="AlertPopRect">
						<div id="AlertPopBody">
							<table class="myAlertPop_table_b" id="waitSettingFinish" border="0" cellspacing="0" style="display:none">
							   <tbody>
									 <tr>
									 	<td>
											<center><div id="Loading_pop_image2"></div></center>
										</td>
									 </tr>
									 <tr>
									 	<td><center><label id="reciprocal_Number">10</label></center></td>
									 </tr>
									 <tr>
									 	<td id="dialog_msg_black2"><script>I18N("h", m_comm_changesdesc);</script></td>
									 </tr>
							   </tbody>
							</table>
							<table class="myAlertPop_table_b" id="SuccessSettings" border="0" cellspacing="0"  style="display:none">
							   <tbody>
									 <tr>
									 	<td>
											<center><div id="Information_pop_image"></div></center>
										</td>
									 </tr>
									 <tr>
										 <td>
										 	<div id="dialog_msg_black"><script>I18N("h", m_comm_settingsave);</script></div>
										 </td>
									 </tr>
									 <tr>
										 <td>
										 	<center><div id="Confirm_btn" onclick="javascript: self.location.href = self.location.href;" style="cursor:pointer"><script>I18N("h", m_comm_ok);</script></div></center>
										 </td>
									 </tr>
							   </tbody>
							</table>
						</div>
					</div>
				</div>					
				<div id="DetectRouterConnection" style="display:none"></div>
				<div id="footer" border="0">
					<div id="copyright"><script>prints(m_comm_copyright);</script></div>
					<div id="help">
						<a target="_blank" href="http://www.dlink.com/support" style="cursor:pointer;text-Decoration:underline">
							
								<script>prints(m_home_gethelp);</script>
							
						</a>
					</div>
				</div>
			</div>
		</div>
	</form>
</body>
</html>
