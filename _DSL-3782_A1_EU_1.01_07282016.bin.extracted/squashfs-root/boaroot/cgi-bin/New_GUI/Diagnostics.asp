<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns= "http://www.w3c.org/1999/xhtml">
<head>
<title>D-LINK</title>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel=stylesheet type="text/css" href="/layout/New_GUI/jquery.selectbox.css?v=20140910163551" />
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialCSS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJQ.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialValidate.js?v=20140910163551"></script>
<script type="text/javascript" src="/js/New_GUI/ZeroClipboard.js"></script>
<!--<script src="/LanguageFamily/en/msg_multipe.js" type="text/javascript"></script>-->

<script>
	var diagnostics_val = {};
	var errinfor = m_diagno_err1;
	var clip = null;
	var wpsTimer = 0;
	var Diagnostics_result_list = new Array();
	
	//white list
	function isHex(cmpStr)
	{
		var regStr=/[a-zA-Z0-9]/;
	  
	  	for(i=0;i<cmpStr.length;i++)
	  	{ 
			if((cmpStr.charAt(i) == '-')||(cmpStr.charAt(i) == '.'))
				continue;
			if (cmpStr.charAt(i).search(regStr)==-1)
				return false;
		}
		return true;	
	}
	function isSafeforXSS(compareStr)
	{
		if((compareStr.charAt(0) == '-') ||(compareStr.charAt(compareStr.length-1) == '-'))
			return false;
		if(!isHex(compareStr)) {
				return false;
			}
		return true;
	}
	function run_test() {
		$("label[class='error']").html("");
		var str = $("#Diagnostics_address").val();
		
		if(!isSafeforXSS(str))
		{
			$("#Diagnostics_address_error").html("<br/>"+m_diagno_err2);
			return;
		}
		
		if (isValidCfgStr('', str, 256) == false || (str == '')) {
			$("#Diagnostics_address_error").html("<br/>"+m_diagno_err3);
			return;
		}

		if (!is_valid_ip(str,0)) {
			if( !isValidUrlName(str)) {
				$("#Diagnostics_address_error").html("<br/>"+m_diagno_err3);
				return;
			}
		}

		if(str.indexOf('.')==-1) {
			$("#Diagnostics_address_error").html("<br/>"+m_diagno_err3);
			return;
		}
		
		if($("div[name='Diagnostics_Test_Info']").eq(0).attr("class") == "clicked") {
			$("#DiagnosticsWizard_result").html(m_diagno_warning1);
			diagnostics_val.Type = "p";
		} else {
			$("#DiagnosticsWizard_result").html(m_diagno_warning2);
			diagnostics_val.Type = "t";
		}

		Diagnostics_result_list = [];

		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			diagnostics_val.sessionKey = sessionKey;
			diagnostics_val.Addr = str;
			setTimeout('$.post("/cgi-bin/New_GUI/Set/Diagnostics.asp", diagnostics_val, function(){getTestInfo();});', 300);
		});
	}

	function getTestInfo() {
		$.get("/cgi-bin/get/New_GUI/Diagnostics.cgi", function(result){
			var tempresult = result.split("&&");

			if(parseInt(tempresult[0])==1) {
				printRst(tempresult[1]);
				wpsTimer=0
			} else {
				if(wpsTimer<=30) {
					setTimeout('getTestInfo()', 3000);
					wpsTimer++;
				} else {
					$("#DiagnosticsWizard_result").html(errinfor);
					wpsTimer=0
				}
			}
		});
	}

	function printRst(pingResult) {		
		pingResult = eval(pingResult);
		if (pingResult != "none") {
			$("#DiagnosticsWizard_result").html("");
			if (pingResult.length > 0) {
				for(var i = 0; i < pingResult.length; i++) {
					Diagnostics_result_list.push(pingResult[i]);
					$("#DiagnosticsWizard_result").append("<p>"+pingResult[i]+"</p>");
				}
			} else {
				$("#DiagnosticsWizard_result").html(errinfor);
			}
		}
	}

	function isValidCfgStr(cfgName, val, len) {
		if (isValidAscii(val) != '')
			return false;
		if (val.length > len)
			return false;
		return true;
	}

	function isValidAscii(val) {
		for ( var i = 0 ; i < val.length ; i++ ) {
			var ch = val.charAt(i);
			if ( ch < ' ' || ch > '~' )
				return ch;
		}
		return '';
	}

	function isValidUrlName(url) {
		if (url == "")
			return false;
		if (url.length < 3)
			return false;

		if (isValidAscii(url) != '')
			return false;

		for (i = 0; i < url.length; i++) {
			if (url.charAt(i) == '\\')
				return false;
		}

		var invalidArray = new Array();
		invalidArray.push("www");
		invalidArray.push("com");
		invalidArray.push("org");
		invalidArray.push("net");
		invalidArray.push("edu");
		invalidArray.push("uk");
		invalidArray.push("www.");
		invalidArray.push(".com");
		invalidArray.push(".org");
		invalidArray.push(".net");
		invalidArray.push(".edu");
		invalidArray.push(".uk");

		var i = 0;
		for(j=0; j< invalidArray.length; j++) {
			if (url == invalidArray[j])
				return false;
			else if(url.indexOf(invalidArray[j]) == -1)
				i++
		}
		if(i == invalidArray.length)
			return false;

		return true;
	}

	function doCopy() {
		if(Diagnostics_result_list.length > 0) {
			if(window.clipboardData) {
				window.clipboardData.setData("text", Diagnostics_result_list.join(""));
				alert(m_diagno_err4);
			} else {
				clip.setText(Diagnostics_result_list.join("")); 
			}
		} else
			alert(m_diagno_err5);
	}
</script>

<script type="text/javascript">
	function Load_HTML()	{	$("#header").load("header.asp");	}
	function Initial() {
		initialMenu();
	}
	function GetXML()	{	document.getElementById("main").style.display = "inline";	}
</script>
<script language="JavaScript">
	$(function() {
		if(!window.clipboardData) {
			clip = new ZeroClipboard.Client();		
			ZeroClipboard.setMoviePath("/js/New_GUI/ZeroClipboard.swf");
			clip.setHandCursor(true);
			clip.addEventListener('load', function (client) {});
			clip.addEventListener('mouseOver', function (client) {});
			clip.addEventListener('complete', function (client,text) {
				if(text=="") {
					alert(m_diagno_err5);
					return;
				} else {
					alert(m_diagno_err4);
				}
			});

			clip.glue("btnCopy");
		}		
		
		$("input[type='text']").each(function() {	$(this).parent().append("<label id='"+$(this).attr("id")+"_error' name='"+$(this).attr("id")+"_error' class='error'></label>");	});

		$("div[name='Diagnostics_Test_Info']").each(function(){
			$(this).click(function() {
				$("div[name='Diagnostics_Test_Info']").attr('class', 'unclick');
				$(this).attr('class', 'clicked');				
			});
		});
	});
</script>
</head>

<body>
	<div id="wrapper">
		<!-------------------- Logo ------------------------->
		<div id="header"></div>
		<!-------------------- Menu ------------------------->
		<div id="menu"></div>
		<div id="menu_edge"></div>
		<!-------------------- Content ---------------------->
		<div id="content">
			<!-------------------- info ---------------------->
	  		<div id="info">
			  	<div id="FunctionName"><script>prints(m_diagno_header);</script></div>
			  	<div id="wall"><!-- <img id="page_Admin" src="/graphic/New_GUI/page_Admin.png?v=20140910163551" alt="" width="195" height="119"/> --></div>
			    <div id="directions">
					<script>prints(m_diagno_desc1);</script><br>
					<script>prints(m_diagno_desc2);</script>
					<label id="Get_Help" onClick="showOnlineHelp('Diagnostics');" style="cursor:pointer;display:none;text-Decoration:underline"><script>prints(m_comm_clickhelp);</script></label>
				</div>
			</div>
		    <!-------------------- funcBar ---------------------->
		    <div id="funcBar">
				<div id="pagePath"><script>prints(m_comm_Managment);</script> >> <script>prints(m_diagno_header);</script></div>
				<ul id="rightFunc"></ul>
			</div>
	    	<!-------------------- main ------------------------->
	     	<div id="main" style="display:none">
 		   		<!-------------------- general ---------------------->
 		   		<form name="adminpassword_Settings" id="adminpassword_Settings" method="POST" action=""> 		   		
				<table class="block" border="0" style="margin: 10px 0 0 0 ;">
				<tbody>					
					 <tr>
				     	<th><script>prints(m_diagno_enteradd);</script>:</th>
				     	<td><input class="styled-text" type="text" name="Diagnostics_address" id="Diagnostics_address" size="30"></td>
				     </tr>
				   	 <tr>
				     	<th><script>prints(m_diagno_selecttest);</script>:</th>
				     	<td>
				     		<table>
								<tr>
									<td><div name="Diagnostics_Test_Info" class='clicked'></div></td>
									<td><script>prints(m_diagno_pingtest);</script></td>
									<td><div name="Diagnostics_Test_Info" class='unclick'></div></td>
									<td><script>prints(m_diagno_tra);</script></td>
									<td>
										<div class="file-box"><button type="button" class="styled_button_s" style="min-width:200px;" onclick="run_test()" ><script>I18N("h", m_diagno_runtest);</script></button></div>
									</td>
								</tr>
				     		</table>
				     	</td>
				     </tr>
				     <tr>
				     	<th><script>prints(m_diagno_resultsforping);</script>:</th>
				     	<td style="width:558px; height:150px; font-size:10pt;BORDER-TOP: #000000 1px solid; BORDER-RIGHT: #000000 1px solid;BORDER-BOTTOM: #000000 1px solid; BORDER-LEFT: #000000 1px solid; LINE-HEIGHT: 18px">
				     		<div style="width:558px; height:150px;overflow-y:scroll;"  align="left" valign="top" align="left" id="DiagnosticsWizard_result">
				     			 - <script>prints(m_diagno_Info);</script> - 
				     		</div>
				     	</td>
				     </tr>
				     <tr>
				     	<th>&nbsp</th>
				     	<td>
				     		<div class="file-box"><button type="button" id="btnCopy" name="btnCopy" class="styled_button_s" style="min-width:200px;" onclick="doCopy()" ><script>I18N("h", m_diagno_Copy);</script></button></div>
				     	</td>
				     </tr>
				</tbody>
			    </table>
			   	</form>			   
		 	</div>				
		 <div id="DetectRouterConnection" style="display:none"></div>
		 <div id="footer" border="0">
			<div id="copyright"><script>prints(m_comm_copyright);</script></div>
			<div id="help">
                <a target="_blank" href="http://www.dlink.com/support" style="cursor:pointer;text-Decoration:underline">
	                
	                    <script>
	                    prints(m_home_gethelp);
	                    </script>                  
	                
                </a>
            </div>
		</div>
	</div>
</body>
<script type="text/javascript">
	Load_HTML();
	Initial();
	setMenu("menu_Management");
	GetXML();
</script>
</html>
