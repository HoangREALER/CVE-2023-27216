<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel=stylesheet type="text/css" href="/layout/New_GUI/jquery.selectbox.css?v=20140910163551" />
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialCSS.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialJQ.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/initialValidate.js?v=20140910163551"></script>
<script type="text/javascript" charset="utf-8" src="/js/New_GUI/configuration/DeviceConfig.js?v=TimeStamp_QzwsxDcRfvTGByHn"></script>
<!--<script src="/LanguageFamily/en/msg_multipe.js" type="text/javascript"></script>-->
<script type="text/javascript">
	var ddns_val = {
		"Active": "<%TCWebApi_get("Ddns_Entry","Active","s")%>",
		"SERVERNAME": "<%TCWebApi_get("Ddns_Entry","SERVERNAME","s")%>",
		"USERNAME": "<%TCWebApi_get("Ddns_Entry","USERNAME","s")%>",
		"PASSWORD": "<%TCWebApi_get("Ddns_Entry","PASSWORD","s")%>",
		"MYHOST": "<%TCWebApi_get("Ddns_Entry","MYHOST","s")%>"
	};

	function Load_HTML() {
		$("#header").load("header.asp");
	}
	
	function Initial() {
		initialMenu();
	}
	function decodeSpecialChr(str)
	{
		str=str.replace(/&amp;/g,"&");
		str=str.replace(/&lt;/g,"<");
		str=str.replace(/&gt;/g,">");
		str=str.replace(/&quot;/g,"\"");
		str=str.replace(/&#39;/g,"'");
		str=str.replace(/&#59;/g,";");
		str=str.replace(/&#61;/g,"=");
		str=str.replace(/&#43;/g,"+");
		str=str.replace(/&#45;/g,"-");
		
		return str;
	}
	function InitDDNS() {
		SetCheckBoxEnable("ddns", true, (ddns_val.Active=="Yes"?true:false));

		if($("#ddns_ck").attr("checked"))
			$("tbody[id='ddns_tbody']").show();
		else
			$("tbody[id='ddns_tbody']").hide();
		
		$("#ddns_server").val(decodeSpecialChr(ddns_val.SERVERNAME));
		$("#user").val(decodeSpecialChr(ddns_val.USERNAME));
		$("#pass").val(decodeSpecialChr(ddns_val.PASSWORD));
		$("#pass2").val(decodeSpecialChr(ddns_val.PASSWORD));
		$("#hostname").val(decodeSpecialChr(ddns_val.MYHOST));
		
		$("#main").show();
	}

	function doSave() {
		$("label[class='error']").html("");
		if($("#ddns_ck").attr("checked")) {
			if (isBlankusername($("#user").val())) {
				$("#user_error").html("<br/>"+m_ddns_error1);
				return false;
			}
			/*if(!isUnsafeChar($("#user").val())) {
				$("#user_error").html("<br/>"+m_ddns_error2);
				return false;
			}*/

			if (isBlank1($("#pass").val())) {
				$("#pass_error").html("<br/>"+m_ddns_error3);
				return false;
			}
			if(!isUnsafeChar($("#pass").val())) {
				$("#pass_error").html("<br/>"+m_ddns_error4);
				return false;
			}
			
			if (isBlank1($("#pass2").val())) {
				$("#pass2_error").html("<br/>"+m_ddns_error3);
				return false;
			}
			if(!isUnsafeChar($("#pass2").val())) {
				$("#pass2_error").html("<br/>"+m_ddns_error4);
				return false;
			}
			
			if ($("#pass").val() != $("#pass2").val()) {
				$("#pass2_error").html("<br/>"+m_ddns_error5);
				return false;
		   	}
		   	
			if (isBlank($("#hostname").val()) || $("#hostname").val().length>32) {
				$("#hostname_error").html("<br/>"+m_ddns_error6);
				return false;
			}
			/*if(!isUnsafeChar($("#hostname").val())) {
				$("#hostname_error").html("<br/>"+m_ddns_error7);
				return false;
			}*/
		}
		
		ddns_val.Active = ($("#ddns_ck").attr("checked")?"Yes":"No");
		ddns_val.SERVERNAME = $("#ddns_server").val();
		ddns_val.USERNAME = $("#user").val();
		ddns_val.PASSWORD = $("#pass").val();
		ddns_val.MYHOST = $("#hostname").val();
	
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("waitSettingFinish").style.display = "inline";
		Start_reciprocal_Number_RestoreConfiguration();

		$.get("/cgi-bin/get/New_GUI/get_sessionKey.asp", function(sessionKey){
			ddns_val.sessionKey = sessionKey;
			setTimeout('$.post("/cgi-bin/New_GUI/Set/DynamicDNS.asp", ddns_val, function(){save_flag = true;});', 300);
		});			
	}

	var save_flag = false;
	var _ReciprocalNumber = 5;
	function Start_reciprocal_Number_RestoreConfiguration() {
		if (_ReciprocalNumber >= 0) {
			document.getElementById("reciprocal_Number").innerHTML = _ReciprocalNumber + " " + I18N("j", m_comm_Sec);
			_ReciprocalNumber --;
			setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
		} else {
			if(save_flag) {
				document.getElementById("waitSettingFinish").style.display = "none";
				document.getElementById("SuccessSettings").style.display = "inline";
			} else {
				setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
			}
		}
	}

	function isBlankusername(s) {
		var i=0;
		if(s.length>32)
		return true;
		for (i=0; i < s.length;i++) {
			if (s.charCodeAt(i)!=32) break;
		}
		if (i==s.length)
		return true;

		return false;
	}

	function isBlank1(s) {
		var i=0;
		if(s.length>15)
			return true;
		for (i=0; i < s.length;i++) {
			if (s.charCodeAt(i)!=32) break;
		}
		if (i==s.length)
			return true;

		return false;
	}
</script>
<script language="JavaScript">
	$(function() {
		$("button, div[name='dhcpradio']").click(function () { save_button_changed(); });
		$("input, textarea, select").change(function () { save_button_changed(); });
		$("input, textarea").keypress(function () { save_button_changed(); });

		$("input[type='text'], input[type='password']").each(function() {	$(this).parent().append("<label id='"+$(this).attr("id")+"_error' name='"+$(this).attr("id")+"_error' class='error'></label>");	});

		$(".checkbox_on, .checkbox_off").click(function() {
			SetCheckBoxEnable($(this).attr("id"));
		});

		var selectWidth = new Object;
		selectWidth.width = 234;
		$("select").selectbox(selectWidth);

		$("#ddns").click(function() {
			if($("#ddns_ck").attr("checked"))
				$("tbody[id='ddns_tbody']").show();
			else
				$("tbody[id='ddns_tbody']").hide();
		});
	});
</script>
</head>

<body>
	<form method="POST" action="">
		<div id="wrapper">
			<!-------------------- Logo ------------------------->
			<div id="header"></div>
			<!-------------------- Menu ------------------------->
			<div id="menu"></div>
			<!-------------------- Content ---------------------->
			<div id="content">
				<!-------------------- info ------------------------->
				<div id="info">
					<div id="FunctionName"><script>I18N("h", m_ddns_header);</script></div>
					<div id="wallimage"><img src="/graphic/New_GUI/wall.png" alt="" width="195" height="119"/></div>
					<div id="directions">
						<script>I18N("h", m_ddns_desc);</script>
					</div>
				</div>
				<!-------------------- funcBar ---------------------->
				<div id="funcBar">
					<div id="pagePath">&nbsp;<script>I18N("h", m_comm_features);</script> >> <script>I18N("h", m_ddns_header);</script></div>
					<ul id="rightFunc">
						<li style="display:block"><div id="Save_btn" onclick="document.getElementById('sumbit_CheckData').click()" style="cursor:pointer; display:none"><script>I18N("h", m_comm_Save);</script></div></li>
						<li style="display:block"><div id="Save_Disable_btn"><script>I18N("h", m_comm_Save);</script></div></li>
						<input id="sumbit_CheckData" class="submit" type="button" value="Submit" style="display:none" onClick="doSave();"/>
					</ul>
				</div>
	     	<!-------------------- main ---------------------->
	     	<div id="main" style="display:none">
				<!-------------------- LAN Router Settings ---------------------->
				<div>
					<table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
						<tbody>
							<tr>
								<td><div class ="title"><script>I18N("h", m_ddns_header);</script></div></td>
								<td></td>
							</tr>

							<tr>
								<th><script>I18N("h", m_ddns_ddnssetting);</script>:</th>
								<td>
									<div id="ddns" class="checkbox_on">
										<input type="checkbox" id="ddns_ck" name="ddns_ck">
									</div>
								</td>
							</tr>

							<tbody id="ddns_tbody" style="display: none;">
								<tr>
									<th><script>I18N("h", m_ddns_ddns);</script>:</th>
									<td>
										<div class="styled-select" >
											<select name="ddns_server" id="ddns_server">
												<option value="www.dyndns.org">www.dyndns.org</option>
												<option value="www.no-ip.com">www.no-ip.com</option>
												<option value="zoneedit.com">zoneedit.com</option> 
												<option value="dlinkddns.com">dlinkddns.com</option>
											</select>
										</div>
									</td>
								</tr>

								<tr>
									<th><script>I18N("h", m_ddns_username);</script>:</th>
									<td><input class="styled-text" type="text" name="user" maxlength="32" size="30" id="user"></td>
								</tr>

								<tr>
									<th><script>I18N("h", m_ddns_pwd);</script>:</th>
									<td><input class="styled-text" type="password" name="pass" maxlength="32" size="30" id="pass" autocomplete="off"></td>
								</tr>

								<tr>
									<th><script>I18N("h", m_ddns_confirmpwd);</script>:</th>
									<td><input class="styled-text" type="password" name="pass2" maxlength="32" size="30" id="pass2" autocomplete="off"></td>
								</tr>

								<tr>
									<th><script>I18N("h", m_ddns_hostname);</script>:</th>
									<td><input class="styled-text" type="text" name="hostname" maxlength="32" size="30" id="hostname"></td>
								</tr>
							</tbody>								
						</tbody>
					</table>						
				</div>

				
				<div id="CreatePopAlertMessage" style="display:none">
					<div id="AlertPopRect">
						<div id="AlertPopBody">
							<table class="myAlertPop_table_b" id="waitSettingFinish" border="0" cellspacing="0" style="display:none">
							   <tbody>
									 <tr>
									 	<td>
											<center><div id="Loading_pop_image2"></div></center>
										</td>
									 </tr>
									 <tr>
									 	<td><center><label id="reciprocal_Number"></label></center></td>
									 </tr>
									 <tr>
									 	<td id="dialog_msg_black2"><script>I18N("h", m_comm_changesdesc);</script></td>
									 </tr>
							   </tbody>
							</table>
							<table class="myAlertPop_table_b" id="SuccessSettings" border="0" cellspacing="0"  style="display:none">
							   <tbody>
									 <tr>
									 	<td>
											<center><div id="Information_pop_image"></div></center>
										</td>
									 </tr>
									 <tr>
										 <td>
										 	<div id="dialog_msg_black"><script>I18N("h", m_comm_settingsave);</script></div>
										 </td>
									 </tr>
									 <tr>
										 <td>
										 	<center><div id="Confirm_btn" onclick="javascript: self.location.href = self.location.href;" style="cursor:pointer"><script>I18N("h", m_comm_ok);</script></div></center>
										 </td>
									 </tr>
							   </tbody>
							</table>
						</div>
					</div>
				</div>					
				<div id="DetectRouterConnection" style="display:none"></div>
				<div id="footer" border="0">
					<div id="copyright"><script>prints(m_comm_copyright);</script></div>
					<div id="help">
						<a target="_blank" href="http://www.dlink.com/support" style="cursor:pointer;text-Decoration:underline">
							
								<script>prints(m_home_gethelp);</script>
							
						</a>
					</div>
				</div>
			</div>
		</div>
	</form>
</body>
<script type="text/javascript">
	Load_HTML();
	Initial();
	setMenu("menu_Advanced");
	InitDDNS();
</script>
</html>
