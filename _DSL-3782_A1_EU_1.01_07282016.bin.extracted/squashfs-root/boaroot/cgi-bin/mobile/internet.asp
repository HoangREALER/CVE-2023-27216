<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title><%tcWebApi_get("Upnpd_Entry","ModelName","s")%></title>
	<link rel="stylesheet" href="/mobile/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="/mobile/style.css">
	<script src="/mobile/jquery.min.js"></script>
	<script src="/mobile/jquery.mobile-1.4.5.min.js"></script>
	<script src="/mobile/initLanguage.js"></script>
</head>
<body>
	<div data-role="page">
		<script type="text/javascript">
			if(top.location.href.indexOf("index.asp") != top.location.href.toString().length - 9) {
				top.location.href = "http://<%TCWebApi_get("Lan_Entry0","IP","s")%>/cgi-bin/mobile/index.asp";
			}

			var n = 5 * 60*1000;
			setTimeout(function(){
				self.location.href = "/cgi-bin/mobile/index.asp";
			}, n);


			function decodeSpecialChr(str) {
				str = str.replace(/&amp;/g, "&");
				str = str.replace(/&lt;/g, "<");
				str = str.replace(/&gt;/g, ">");
				str = str.replace(/&quot;/g, "\"");
				str = str.replace(/&#39;/g, "'");
				str = str.replace(/&#59;/g, ";");
				str = str.replace(/&#61;/g, "=");
				str = str.replace(/&#43;/g, "+");
				str = str.replace(/&#45;/g, "-");
				return str;
			}

			var conn_time = 0;
			var WanMode = decodeSpecialChr('<%tcWebApi_get("Wan_Common","WanMode","s")%>');
			var TransMode = decodeSpecialChr('<%tcWebApi_get("Wan_Common","TransMode","s")%>');

			var internet_status_adsl = 0;
			var internet_status_ptm = 0;
			var internet_status_3g = 0;
			var connType_adsl = decodeSpecialChr('<%tcWebApi_get("DeviceInfo_PVC0","connType","s")%>');
			if(connType_adsl != "Bridge") {
				var status_adsl = decodeSpecialChr('<%tcWebApi_get("DeviceInfo_PVC0","Status","s")%>');
				if(status_adsl == "1") {
					var wanip_adsl = decodeSpecialChr('<%tcWebApi_get("DeviceInfo_PVC0","WanIP","s")%>');
					if(wanip_adsl != "10.64.64.64")
						internet_status_adsl = 1;
				}
			} else {
				var lineState = decodeSpecialChr('<%tcWebApi_get("Info_Adsl","lineState","s")%>');
				if(lineState == "up")
					internet_status_adsl = 1;
			}

			var connType_fiber = decodeSpecialChr('<%tcWebApi_get("DeviceInfoExt_PVC8e0","connType","s")%>');
			if(connType_fiber != "Bridge") {
				var status_fiber = decodeSpecialChr('<%tcWebApi_get("DeviceInfoExt_PVC8e0","Status","s")%>');
				if(status_fiber == "1") {
					var wanip_ptm = decodeSpecialChr('<%tcWebApi_get("DeviceInfoExt_PVC8e0","WanIP","s")%>');
					if(wanip_ptm != "10.64.64.64")
						internet_status_ptm = 1;
				}
			} else {
				var lineState = decodeSpecialChr('<%tcWebApi_get("Info_Adsl","lineState","s")%>');
				if(lineState == "up")
					internet_status_ptm = 1;
			}

			var status_3g = '<%tcWebApi_get("DongleInfo","Status","s")%>';
			if(status_3g == "1")
				internet_status_3g = 1;

			var getNetworkStatus = 'DISCONNECTED';
			if(WanMode=="ADSL") {
				if(internet_status_adsl==1)
					getNetworkStatus = 'CONNECTED';
			} else if(WanMode=="VDSL") {
				if(internet_status_ptm==1)
					getNetworkStatus = 'CONNECTED';
			} else if(WanMode=="3G") {
				if(internet_status_3g==1)
					getNetworkStatus = 'CONNECTED';
			} else if(WanMode=="Auto") {
				if(internet_status_adsl==1||internet_status_ptm==1||internet_status_3g==1)
					getNetworkStatus = 'CONNECTED';
			}

			var connectionType = "";
			var getIPAddress = "";
			var get_WanMacAddress = "";
			var getSubnetmask = "";
			var getDefaultgateway = "";
			var DeviceModel = "";
			switch(TransMode) {
				case "3G":				
					DeviceModel = "3G";
					connectionType = decodeSpecialChr('<%tcWebApi_get("DongleInfo","connType","s")%>');
					getIPAddress = '<%tcWebApi_get("DongleInfo","WanIP","s")%>';

					getSubnetmask  = '<%tcWebApi_get("DongleInfo","WanSubMask","s")%>';
					getDefaultgateway  = '<%tcWebApi_get("DongleInfo","WanDefGW","s")%>';
					break;
				case "ATM":		
					DeviceModel = "ADSL";
					connectionType = decodeSpecialChr('<%tcWebApi_get("DeviceInfo_PVC0","connType","s")%>');
					getIPAddress = '<%tcWebApi_get("DeviceInfo_PVC0","WanIP","s")%>';
					get_WanMacAddress = '<%tcWebApi_get("DeviceInfo_PVC0","WanMac","s")%>';
					getSubnetmask  = '<%tcWebApi_get("DeviceInfo_PVC0","WanSubMask","s")%>';
					getDefaultgateway  = '<%tcWebApi_get("DeviceInfo_PVC0","WanDefGW","s")%>';
					break;
				case "PTM":		
					DeviceModel = "VDSL";
					connectionType = decodeSpecialChr('<%tcWebApi_get("DeviceInfoExt_PVC8e0","connType","s")%>');
					getIPAddress = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","WanIP","s")%>';
					get_WanMacAddress = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","WanMac","s")%>';
					getSubnetmask  = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","WanSubMask","s")%>';
					getDefaultgateway  = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","WanDefGW","s")%>';
					break;
			}

			var getPridns = "";
			var getSecdns = "";

			if('<%tcWebApi_get("Dproxy_Entry","type","s")%>' == "1") {
				getPridns = '<%tcWebApi_get("Dproxy_Entry","Primary_DNS","s")%>';
				getSecdns = '<%tcWebApi_get("Dproxy_Entry","Secondary_DNS","s")%>';
			} else {
				switch(TransMode) {
					case "3G":
						getPridns = '<%tcWebApi_get("DongleInfo","DNSIP","s")%>';
						getSecdns = '<%tcWebApi_get("DongleInfo","SECDNSIP","s")%>';
						break;
					case "ATM":		
						getPridns = '<%tcWebApi_get("DeviceInfo_PVC0","DNSIP","s")%>';
						getSecdns = '<%tcWebApi_get("DeviceInfo_PVC0","SECDNSIP","s")%>';
						break;
					case "PTM":		
						getPridns = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","DNSIP","s")%>';
						getSecdns = '<%tcWebApi_get("DeviceInfoExt_PVC8e0","SECDNSIP","s")%>';
						break;		
				}
			}			

			$(function(){
				if(getNetworkStatus == "DISCONNECTED") {
					$("#internet_stauts").prop("src", "/mobile/images/mobile_internet.png");
					$("#inter_status").html(m_comm_disconn);
					if(connectionType.indexOf("PPPoE") != -1 || connectionType.indexOf("PPPoA") != -1){
						$("#div_disconn").hide();
						$("#div_conn").show();
					}
				} else {

					switch(TransMode) {
						case "3G":				
							$("#dsl_type").html(m_comm_3G);
							break;
						case "ATM":		
							$("#dsl_type").html(m_comm_adsl);
							break;
						case "PTM":	
							$("#dsl_type").html(m_comm_VDSL);
							break;
					}

					if(connectionType.indexOf("Bridge") != -1) {
						$("#internet_stauts").prop("src", "/mobile/images/mobile_internet_connected.png");
						$("#inter_status").html(m_comm_conn);
						$("#conn_info").show();
						GetConnectionUpTime();
					} else {
						if (getIPAddress != "" && getIPAddress != "0.0.0.0") {
							$("#internet_stauts").prop("src", "/mobile/images/mobile_internet_connected.png");
							$("#inter_status").html(m_comm_conn);
							$("#conn_info").show();
							GetConnectionUpTime();

							$("#conn_type").html(connectionType);
							$("#conn_mac").html(get_WanMacAddress);
							$("#conn_ip").html(getIPAddress);
							$("#conn_mask").html(getSubnetmask);
							$("#conn_gateway").html(getDefaultgateway);

							if(getPridns != "") {
								$("#conn_dns1").html(getPridns);
								if(getSecdns != "") {
									$("#conn_dns2").html(getSecdns);
								}
							}

							if(connectionType.indexOf("PPPoE") != -1 || connectionType.indexOf("PPPoA") != -1){
								$("#div_conn").hide();
								$("#div_disconn").show();
							}
						} else {
							$("#internet_stauts").prop("src", "/mobile/images/mobile_internet.png");
							$("#inter_status").html(m_comm_disconn);
							if(connectionType.indexOf("PPPoE") != -1 || connectionType.indexOf("PPPoA") != -1){
								$("#div_disconn").hide();
								$("#div_conn").show();
							}
						}
					}
				}

				$("#btn_connect").on("tap", function(){
					$.mobile.loading('show');
					var data = {};

					data.connType = "ATM";
					var model = DeviceModel;
					if(model.indexOf("3G") != -1)
						data.connType = "3G";
					else if(model.indexOf("ADSL") != -1)
						data.connType = "ATM";
					else if(model.indexOf("VDSL") != -1)
						data.connType = "PTM";
						
					data.DipConnFlag = 1;
					$.get("/cgi-bin/get/New_GUI/get_session_connection.asp", function(dates){
						var d = dates.split("|");
						data.sessionKey = d[0];
						data.connection = d[1];
						$.ajax({
							type: "POST",
							url: "/cgi-bin/New_GUI/Set/home_DipConn.asp",
							data: jQuery.param(data),
							async: false,
							cache: false,
							dataType: "text",
							success: function(){
								conn_time = 0;
								setTimeout(function(){
									GetResult_WANCDN();
								}, 5000);								
							},
							error: function(XMLHttpRequest, textStatus, errorThrown) {
								$.mobile.loading('hide');
								$("#popupMsg").html(m_comm_saveerr);
								$("#popup_msg").click();
							}
						});			
					});	
				});

				$("#btn_disconnect").on("tap", function(){
					$.mobile.loading('show');
					var data = {};

					data.connType = "ATM";
					var model = DeviceModel;
					if(model.indexOf("3G") != -1)
						data.connType = "3G";
					else if(model.indexOf("ADSL") != -1)
						data.connType = "ATM";
					else if(model.indexOf("VDSL") != -1)
						data.connType = "PTM";
					
					data.DipConnFlag = 2;
					$.get("/cgi-bin/get/New_GUI/get_session_connection.asp", function(dates){
						var d = dates.split("|");
						data.sessionKey = d[0];
						data.connection = d[1];
						$.ajax({
							type: "POST",
							url: "/cgi-bin/New_GUI/Set/home_DipConn.asp",
							data: jQuery.param(data),
							async: false,
							cache: false,
							dataType: "text",
							success: function(){
								conn_time = 0;
								setTimeout(function(){
									GetResult_WANCD();
								}, 5000);
							},
							error: function(XMLHttpRequest, textStatus, errorThrown) {
								$.mobile.loading('hide');
								$("#popupMsg").html(m_comm_saveerr);
								$("#popup_msg").click();
							}
						});			
					});	
				});
			});

			function GetResult_WANCD() {
				if(conn_time >= 12) {
					$.mobile.loading('hide');
					$("#popupMsg").html(m_comm_mobile_wan_disconn_error);
					$("#popup_msg").click();
					return;
				}
				conn_time++;
				$.get("/cgi-bin/get/New_GUI/home_DipConn_Status.asp", function() {
					var getNetworkStatus = 'DISCONNECTED';
					if (WanMode == "ADSL") {
						if (internet_status_adsl == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "VDSL") {
						if (internet_status_ptm == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "3G") {
						if (internet_status_3g == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "Auto") {
						if (internet_status_adsl == 1 || internet_status_ptm == 1 || internet_status_3g == 1)
							getNetworkStatus = 'CONNECTED';
					}

					if (getNetworkStatus == "DISCONNECTED") {
						self.location.href = "/cgi-bin/mobile/internet.asp";
					} else {
						setTimeout(function(){
							GetResult_WANCD();
						}, 5000);
					}
				}, 'script');
			}

			function GetResult_WANCDN() {
				if(conn_time >= 12) {
					$.mobile.loading('hide');
					$("#popupMsg").html(m_comm_mobile_wan_conn_error);
					$("#popup_msg").click();
					return;
				}
				conn_time++;
				$.get("/cgi-bin/get/New_GUI/home_DipConn_Status.asp", function() {
					var getNetworkStatus = 'DISCONNECTED';
					if (WanMode == "ADSL") {
						if (internet_status_adsl == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "VDSL") {
						if (internet_status_ptm == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "3G") {
						if (internet_status_3g == 1)
							getNetworkStatus = 'CONNECTED';
					} else if (WanMode == "Auto") {
						if (internet_status_adsl == 1 || internet_status_ptm == 1 || internet_status_3g == 1)
							getNetworkStatus = 'CONNECTED';
					}

					if (getNetworkStatus == "CONNECTED") {
						self.location.href = "/cgi-bin/mobile/internet.asp";
					} else {
						setTimeout(function(){
							GetResult_WANCDN();
						}, 5000);
					}
				}, 'script');
			}

			function GetConnectionUpTime() {
				if ($("#conn_type").html().indexOf("Bridge") == -1) {
					$.get("/cgi-bin/get/New_GUI/home_internet_connTime.asp", function() {
						var getConnectionUpTime = 0;
						switch (TransMode) {
							case "3G":
								getConnectionUpTime = connTime_3G;
								break;
							case "ATM":
								getConnectionUpTime = connTime_ADSL;
								break;
							case "PTM":
								getConnectionUpTime = connTime_VDSL;
								break;
						}

						if (getConnectionUpTime > 0) {
							wan_Uptime_Sec = getConnectionUpTime % 60;
							wan_Uptime_Min = Math.floor(getConnectionUpTime / 60) % 60;
							wan_Uptime_Hour = Math.floor(getConnectionUpTime / 3600) % 24;
							wan_Uptime_Day = Math.floor(getConnectionUpTime / 86400);
							if (wan_Uptime_Sec < 0) {
								wan_Uptime_Sec = 0;
								wan_Uptime_Min = 0;
								wan_Uptime_Hour = 0;
								wan_Uptime_Day = 0;
							}
						} else {
							wan_Uptime_Sec = 0;
							wan_Uptime_Min = 0;
							wan_Uptime_Hour = 0;
							wan_Uptime_Day = 0;
						}

						document.getElementById("conn_time").innerHTML = wan_Uptime_Day + " " + m_comm_day + " " + wan_Uptime_Hour + " " + m_comm_Hour + " " + wan_Uptime_Min + " " + m_comm_Min + " " + wan_Uptime_Sec + " " + m_comm_sec;
					}, 'script');
				} else {
					$("#conn_time").html(m_comm_notavilable);
				}
			}
		</script>
		<div data-role="header" data-theme="c" data-position="fixed">
			<a href="/cgi-bin/mobile/menu.asp" data-role="button" data-icon="home" data-ajax=false><script>document.write(m_comm_mobile_home);</script></a>
			<h2><img src="/mobile/images/mobile_dlink_logo.png" class="title_logo"></h2>
		</div>

		<div role="main" class="ui-content">

			<div style="height: 45px; vertical-align: middle;">
				<img src="/mobile/images/mobile_internet.png" style="width: 60px; margin-left: 20%;" id="internet_stauts"> 
				<span style="vertical-align: 70%" id="inter_status"></span>
			</div>

			<table data-column-btn-theme="b" class="ui-body-d ui-shadow ui-table" id="conn_info" style="display: none;">
				<tbody>
					<tr>
						<td><script>document.write(m_home_dsltype);</script></td>
						<td id="dsl_type"><script>document.write(m_comm_notavilable);</script></td>
					</tr>
					<tr>
						<td><script>document.write(m_comm_conntype);</script></td>
						<td id="conn_type"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_home_connuptime);</script></td>
						<td id="conn_time"><script>document.write(m_comm_notavilable);</script></td>
					</tr>
					<tr>
						<td><script>document.write(m_comm_mac);</script></td>
						<td id="conn_mac"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_comm_ip);</script></td>
						<td id="conn_ip"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_comm_submask);</script></td>
						<td id="conn_mask"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_comm_defgateway);</script></td>
						<td id="conn_gateway"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_comm_pridns);</script></td>
						<td id="conn_dns1"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
					<tr>
						<td><script>document.write(m_comm_sec_dns);</script></td>
						<td id="conn_dns2"><script>document.write(m_comm_notavilable);</script></td>
					</tr>	
				</tbody>
			</table>

			<div style="display: none;" id="div_conn">
				<button id="btn_connect"><script>document.write(m_comm_connect);</script></button>
			</div>

			<div style="display: none;" id="div_disconn">
				<button id="btn_disconnect"><script>document.write(m_comm_disconnect);</script></button>
			</div>			

			<a href="#positionWindow" id="popup_msg" style="display: none;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline" data-rel="popup" data-position-to="window"></a>
			<div data-role="popup" id="positionWindow" class="ui-content" data-theme="a">
				<p id="popupMsg"></p>
			</div>

			<div class="copyright">
				<script>document.write(m_comm_copyright);</script>
			</div>

		</div>
	</div>
</body>
</html>